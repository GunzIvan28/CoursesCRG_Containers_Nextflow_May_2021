<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.3 Docker recipes | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</title>
  <meta name="description" content="3.3 Docker recipes | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="3.3 Docker recipes | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.3 Docker recipes | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  
  
  

<meta name="author" content="Sarah Bonnin, Luca Cozzuto, Toni Hermoso, Julia Ponomarenko" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-existing-images.html"/>
<link rel="next" href="volumes.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Courses@CRG 2021</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome and about the course</a><ul>
<li class="chapter" data-level="1.1" data-path="meet-the-organizers-and-instructors.html"><a href="meet-the-organizers-and-instructors.html"><i class="fa fa-check"></i><b>1.1</b> Meet the organizers and instructors</a></li>
<li class="chapter" data-level="1.2" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i><b>1.2</b> About the course</a><ul>
<li class="chapter" data-level="1.2.1" data-path="about-the-course.html"><a href="about-the-course.html#outline"><i class="fa fa-check"></i><b>1.2.1</b> Outline</a></li>
<li class="chapter" data-level="1.2.2" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i><b>1.2.2</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2.3" data-path="about-the-course.html"><a href="about-the-course.html#prerequisite-dates-time-location"><i class="fa fa-check"></i><b>1.2.3</b> Prerequisite, Dates, time, location</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1.3</b> Program</a><ul>
<li class="chapter" data-level="1.3.1" data-path="program.html"><a href="program.html#may-3-4-containers"><i class="fa fa-check"></i><b>1.3.1</b> May 3-4: Containers</a></li>
<li class="chapter" data-level="1.3.2" data-path="program.html"><a href="program.html#may-10-11-nextflow"><i class="fa fa-check"></i><b>1.3.2</b> May 10-11: Nextflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-containers.html"><a href="introduction-to-containers.html"><i class="fa fa-check"></i><b>2</b> Introduction to containers</a><ul>
<li class="chapter" data-level="2.1" data-path="what-are-containers.html"><a href="what-are-containers.html"><i class="fa fa-check"></i><b>2.1</b> What are containers ?</a></li>
<li class="chapter" data-level="2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html"><i class="fa fa-check"></i><b>2.2</b> Virtual machines or containers ?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtualisation"><i class="fa fa-check"></i><b>2.2.1</b> Virtualisation</a></li>
<li class="chapter" data-level="2.2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#containerisation-aka-lightweight-virtualisation"><i class="fa fa-check"></i><b>2.2.2</b> Containerisation (aka lightweight virtualisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtual-machines-vs-containers"><i class="fa fa-check"></i><b>2.2.3</b> Virtual machines vs containers</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="history-of-containers.html"><a href="history-of-containers.html"><i class="fa fa-check"></i><b>2.3</b> History of containers</a><ul>
<li class="chapter" data-level="2.3.1" data-path="history-of-containers.html"><a href="history-of-containers.html#chroot"><i class="fa fa-check"></i><b>2.3.1</b> chroot</a></li>
<li class="chapter" data-level="2.3.2" data-path="history-of-containers.html"><a href="history-of-containers.html#additions-in-linux-kernel"><i class="fa fa-check"></i><b>2.3.2</b> Additions in Linux kernel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="docker.html"><a href="docker.html"><i class="fa fa-check"></i><b>3</b> Docker</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html"><i class="fa fa-check"></i><b>3.1</b> Introduction to Docker</a><ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#what-is-docker"><i class="fa fa-check"></i><b>3.1.1</b> What is Docker?</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-components"><i class="fa fa-check"></i><b>3.1.2</b> Docker components</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#images-versus-containers"><i class="fa fa-check"></i><b>3.1.3</b> Images versus containers</a></li>
<li class="chapter" data-level="3.1.4" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-vocabulary"><i class="fa fa-check"></i><b>3.1.4</b> Docker vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-existing-images.html"><a href="using-existing-images.html"><i class="fa fa-check"></i><b>3.2</b> Using existing images</a><ul>
<li class="chapter" data-level="3.2.1" data-path="using-existing-images.html"><a href="using-existing-images.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="using-existing-images.html"><a href="using-existing-images.html#explore-docker-hub"><i class="fa fa-check"></i><b>3.2.2</b> Explore Docker hub</a></li>
<li class="chapter" data-level="3.2.3" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-pull-import-an-image"><i class="fa fa-check"></i><b>3.2.3</b> docker pull: import an image</a></li>
<li class="chapter" data-level="3.2.4" data-path="using-existing-images.html"><a href="using-existing-images.html#biocontainers"><i class="fa fa-check"></i><b>3.2.4</b> BioContainers</a></li>
<li class="chapter" data-level="3.2.5" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-run-run-image-i.e.-start-a-container"><i class="fa fa-check"></i><b>3.2.5</b> docker run: run image, i.e. start a container</a></li>
<li class="chapter" data-level="3.2.6" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-ps-check-containers-status"><i class="fa fa-check"></i><b>3.2.6</b> docker ps: check containers status</a></li>
<li class="chapter" data-level="3.2.7" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-exec-execute-process-in-running-container"><i class="fa fa-check"></i><b>3.2.7</b> docker exec: execute process in running container</a></li>
<li class="chapter" data-level="3.2.8" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-stop-start-restart-actions-on-container"><i class="fa fa-check"></i><b>3.2.8</b> docker stop, start, restart: actions on container</a></li>
<li class="chapter" data-level="3.2.9" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-rm-docker-rmi-clean-up"><i class="fa fa-check"></i><b>3.2.9</b> docker rm, docker rmi: clean up!</a></li>
<li class="chapter" data-level="3.2.10" data-path="using-existing-images.html"><a href="using-existing-images.html#exercise"><i class="fa fa-check"></i><b>3.2.10</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="docker-recipes.html"><a href="docker-recipes.html"><i class="fa fa-check"></i><b>3.3</b> Docker recipes</a><ul>
<li class="chapter" data-level="3.3.1" data-path="docker-recipes.html"><a href="docker-recipes.html#building-recipes"><i class="fa fa-check"></i><b>3.3.1</b> Building recipes</a></li>
<li class="chapter" data-level="3.3.2" data-path="docker-recipes.html"><a href="docker-recipes.html#docker-build"><i class="fa fa-check"></i><b>3.3.2</b> docker build</a></li>
<li class="chapter" data-level="3.3.3" data-path="docker-recipes.html"><a href="docker-recipes.html#docker-tag"><i class="fa fa-check"></i><b>3.3.3</b> docker tag</a></li>
<li class="chapter" data-level="3.3.4" data-path="docker-recipes.html"><a href="docker-recipes.html#build-cache"><i class="fa fa-check"></i><b>3.3.4</b> Build cache</a></li>
<li class="chapter" data-level="3.3.5" data-path="docker-recipes.html"><a href="docker-recipes.html#more-advanced-image-building"><i class="fa fa-check"></i><b>3.3.5</b> More advanced image building</a></li>
<li class="chapter" data-level="3.3.6" data-path="docker-recipes.html"><a href="docker-recipes.html#additional-commands"><i class="fa fa-check"></i><b>3.3.6</b> Additional commands</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="volumes.html"><a href="volumes.html"><i class="fa fa-check"></i><b>3.4</b> Volumes</a></li>
<li class="chapter" data-level="3.5" data-path="ports.html"><a href="ports.html"><i class="fa fa-check"></i><b>3.5</b> Ports</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="singularity.html"><a href="singularity.html"><i class="fa fa-check"></i><b>4</b> Singularity</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html"><i class="fa fa-check"></i><b>4.1</b> Introduction to Singularity</a><ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#singularity-architecture"><i class="fa fa-check"></i><b>4.1.1</b> Singularity architecture</a></li>
<li class="chapter" data-level="4.1.2" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#strengths"><i class="fa fa-check"></i><b>4.1.2</b> Strengths</a></li>
<li class="chapter" data-level="4.1.3" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#weaknesses"><i class="fa fa-check"></i><b>4.1.3</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="build-process.html"><a href="build-process.html"><i class="fa fa-check"></i><b>4.2</b> Build process</a><ul>
<li class="chapter" data-level="4.2.1" data-path="build-process.html"><a href="build-process.html#examples"><i class="fa fa-check"></i><b>4.2.1</b> Examples</a></li>
<li class="chapter" data-level="4.2.2" data-path="build-process.html"><a href="build-process.html#registries"><i class="fa fa-check"></i><b>4.2.2</b> Registries</a></li>
<li class="chapter" data-level="4.2.3" data-path="build-process.html"><a href="build-process.html#sandboxing"><i class="fa fa-check"></i><b>4.2.3</b> Sandboxing</a></li>
<li class="chapter" data-level="4.2.4" data-path="build-process.html"><a href="build-process.html#singularity-recipes"><i class="fa fa-check"></i><b>4.2.4</b> Singularity recipes</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="remote-building-optional.html"><a href="remote-building-optional.html"><i class="fa fa-check"></i><b>4.3</b> Remote building (optional)</a></li>
<li class="chapter" data-level="4.4" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html"><i class="fa fa-check"></i><b>4.4</b> Run and execution process</a></li>
<li class="chapter" data-level="4.5" data-path="singularity-shell.html"><a href="singularity-shell.html"><i class="fa fa-check"></i><b>4.5</b> Singularity shell</a><ul>
<li class="chapter" data-level="4.5.1" data-path="singularity-shell.html"><a href="singularity-shell.html#singularity-run"><i class="fa fa-check"></i><b>4.5.1</b> Singularity run</a></li>
<li class="chapter" data-level="4.5.2" data-path="singularity-shell.html"><a href="singularity-shell.html#singularity-exec"><i class="fa fa-check"></i><b>4.5.2</b> Singularity exec</a></li>
<li class="chapter" data-level="4.5.3" data-path="singularity-shell.html"><a href="singularity-shell.html#environment-control"><i class="fa fa-check"></i><b>4.5.3</b> Environment control</a></li>
<li class="chapter" data-level="4.5.4" data-path="singularity-shell.html"><a href="singularity-shell.html#execute-from-sandboxed-images-directories"><i class="fa fa-check"></i><b>4.5.4</b> Execute from sandboxed images / directories</a></li>
<li class="chapter" data-level="4.5.5" data-path="singularity-shell.html"><a href="singularity-shell.html#run-straight-from-registry"><i class="fa fa-check"></i><b>4.5.5</b> Run straight from registry</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="bind-paths-aka-volumes.html"><a href="bind-paths-aka-volumes.html"><i class="fa fa-check"></i><b>4.6</b> Bind paths (aka volumes)</a></li>
<li class="chapter" data-level="4.7" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>4.7</b> Exercises:</a></li>
<li class="chapter" data-level="4.8" data-path="instances.html"><a href="instances.html"><i class="fa fa-check"></i><b>4.8</b> Instances</a></li>
<li class="chapter" data-level="4.9" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>4.9</b> Troubleshooting</a><ul>
<li class="chapter" data-level="4.9.1" data-path="troubleshooting.html"><a href="troubleshooting.html#fakeroot"><i class="fa fa-check"></i><b>4.9.1</b> Fakeroot</a></li>
<li class="chapter" data-level="4.9.2" data-path="troubleshooting.html"><a href="troubleshooting.html#singularity-cache-directory"><i class="fa fa-check"></i><b>4.9.2</b> Singularity cache directory</a></li>
<li class="chapter" data-level="4.9.3" data-path="troubleshooting.html"><a href="troubleshooting.html#global-singularity-configuration"><i class="fa fa-check"></i><b>4.9.3</b> Global singularity configuration</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="nextflow-day-1.html"><a href="nextflow-day-1.html"><i class="fa fa-check"></i><b>5</b> Nextflow day 1</a><ul>
<li class="chapter" data-level="5.1" data-path="what-is-nextflow.html"><a href="what-is-nextflow.html"><i class="fa fa-check"></i><b>5.1</b> What is Nextflow?</a></li>
<li class="chapter" data-level="5.2" data-path="what-is-nextflow-for.html"><a href="what-is-nextflow-for.html"><i class="fa fa-check"></i><b>5.2</b> What is Nextflow for?</a></li>
<li class="chapter" data-level="5.3" data-path="main-advantages.html"><a href="main-advantages.html"><i class="fa fa-check"></i><b>5.3</b> Main advantages</a></li>
<li class="chapter" data-level="5.4" data-path="workflow-structure.html"><a href="workflow-structure.html"><i class="fa fa-check"></i><b>5.4</b> Workflow structure</a></li>
<li class="chapter" data-level="5.5" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>5.5</b> Installation</a></li>
<li class="chapter" data-level="5.6" data-path="channels.html"><a href="channels.html"><i class="fa fa-check"></i><b>5.6</b> Channels</a></li>
<li class="chapter" data-level="5.7" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i><b>5.7</b> EXERCISE 1</a></li>
<li class="chapter" data-level="5.8" data-path="processes.html"><a href="processes.html"><i class="fa fa-check"></i><b>5.8</b> Processes</a></li>
<li class="chapter" data-level="5.9" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5.9</b> Workflow</a></li>
<li class="chapter" data-level="5.10" data-path="nextflow-log.html"><a href="nextflow-log.html"><i class="fa fa-check"></i><b>5.10</b> Nextflow log</a></li>
<li class="chapter" data-level="5.11" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i><b>5.11</b> EXERCISE 2</a></li>
<li class="chapter" data-level="5.12" data-path="more-complex-scripts.html"><a href="more-complex-scripts.html"><i class="fa fa-check"></i><b>5.12</b> More complex scripts</a></li>
<li class="chapter" data-level="5.13" data-path="exercise-3.html"><a href="exercise-3.html"><i class="fa fa-check"></i><b>5.13</b> EXERCISE 3</a></li>
<li class="chapter" data-level="5.14" data-path="resuming-your-pipeline.html"><a href="resuming-your-pipeline.html"><i class="fa fa-check"></i><b>5.14</b> Resuming your pipeline</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nextflow-day-2.html"><a href="nextflow-day-2.html"><i class="fa fa-check"></i><b>6</b> Nextflow day 2</a><ul>
<li class="chapter" data-level="6.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html"><i class="fa fa-check"></i><b>6.1</b> Decoupling resources, parameters and nextflow script</a><ul>
<li class="chapter" data-level="6.1.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html#publishing-final-results"><i class="fa fa-check"></i><b>6.1.1</b> Publishing final results</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="adding-a-help-section-for-the-whole-pipeline.html"><a href="adding-a-help-section-for-the-whole-pipeline.html"><i class="fa fa-check"></i><b>6.2</b> Adding a help section for the whole pipeline</a></li>
<li class="chapter" data-level="6.3" data-path="using-singularity.html"><a href="using-singularity.html"><i class="fa fa-check"></i><b>6.3</b> Using Singularity</a></li>
<li class="chapter" data-level="6.4" data-path="adding-more-steps.html"><a href="adding-more-steps.html"><i class="fa fa-check"></i><b>6.4</b> Adding more steps</a></li>
<li class="chapter" data-level="6.5" data-path="modules-and-re-usage-of-the-code.html"><a href="modules-and-re-usage-of-the-code.html"><i class="fa fa-check"></i><b>6.5</b> Modules and re-usage of the code</a></li>
<li class="chapter" data-level="6.6" data-path="exercise-4.html"><a href="exercise-4.html"><i class="fa fa-check"></i><b>6.6</b> EXERCISE 4</a></li>
<li class="chapter" data-level="6.7" data-path="reporting-and-graphical-interface.html"><a href="reporting-and-graphical-interface.html"><i class="fa fa-check"></i><b>6.7</b> Reporting and graphical interface</a></li>
<li class="chapter" data-level="6.8" data-path="share-nextflow-pipelines-and-good-practices.html"><a href="share-nextflow-pipelines-and-good-practices.html"><i class="fa fa-check"></i><b>6.8</b> Share Nextflow pipelines and good practices</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://biocore.crg.eu/wiki/Main_Page" target="blank">BIOINFORMATICS CORE @ CRG</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="docker-recipes" class="section level2">
<h2><span class="header-section-number">3.3</span> Docker recipes</h2>
<p>A <strong>Docker recipe</strong> contains a set of instructions and commands that will be used to <strong>create/build a Docker image</strong>.</p>
<div id="building-recipes" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Building recipes</h3>
<p>All commands should be saved in a text file, named by default <strong>Dockerfile</strong>.</p>
<div id="basic-instructions" class="section level4">
<h4><span class="header-section-number">3.3.1.1</span> Basic instructions</h4>
<p>Each row in the recipe corresponds to a <strong>layer</strong> of the final image.</p>
<p><strong>FROM</strong>: parent image. Typically, an operating system. This is the <strong>base layer</strong>.</p>
<pre class="docker"><code>FROM ubuntu:18.04</code></pre>
<p><strong>RUN</strong>: the command to execute inside the image filesystem.
<br>
Think about it this way: every <strong>RUN</strong> line is essentially what you would run to install programs on a freshly installed Ubuntu OS.</p>
<pre class="docker"><code>RUN apt install wget</code></pre>
<p>A basic recipe that is taking the <strong>ubuntu:18.04</strong> image as a base layer, that updates and upgrades Linux packages, and that installs <code>wget</code>:</p>
<pre class="docker"><code>FROM ubuntu:18.04

RUN apt update &amp;&amp; apt -y upgrade
RUN apt install -y wget</code></pre>
<center>
<h4 style="background-color: #e6fadc; display: inline-block;">
<strong>HANDS-ON</strong>
</h4>
</center>
<p>Explore this <a href="https://github.com/BioContainers/containers/blob/master/blast/2.2.31/Dockerfile">Dockerfile</a>:</p>
<ul>
<li>What is the <strong>base layer</strong>?</li>
<li>What is being installed in the email? How?</li>
</ul>
<details>
<summary>
<h5 style="background-color: #e6fadc; display: inline-block;">
<em>Answer</em>
</h5>
<p></summary></p>
<p>Base layer: biocontainers/biocontainers:v1.0.0_cv4
<b>
Tool <code>blast</code> is installed using *conda**.</p>
</details>
</div>
<div id="more-instructions" class="section level4">
<h4><span class="header-section-number">3.3.1.2</span> More instructions</h4>
<p><strong>MAINTAINER</strong></p>
<p>Who is maintaining the container?</p>
<pre class="docker"><code>MAINTAINER Toni Hermoso Pulido &lt;toni.hermoso@crg.eu&gt;</code></pre>
<p><strong>WORKDIR</strong>: all subsequent actions will be executed in that working directory</p>
<pre class="docker"><code>WORKDIR ~</code></pre>
<p><strong>ADD, COPY</strong>: add files to the image filesystem</p>
<p>Difference between ADD and COPY explained <a href="https://stackoverflow.com/questions/24958140/what-is-the-difference-between-the-copy-and-add-commands-in-a-dockerfile">here</a> and <a href="https://nickjanetakis.com/blog/docker-tip-2-the-difference-between-copy-and-add-in-a-dockerile">here</a></p>
<p><strong>COPY</strong>: lets you copy a local file or directory from your host (the machine from which you are building the image)</p>
<p><strong>ADD</strong>: same, but ADD works also for URLs, and for .tar archives that will be automatically extracted upon being copied.</p>
<pre class="docker"><code># COPY source destination
COPY ~/.bashrc .</code></pre>
<p><strong>ENV, ARG</strong>: run and build environment variables</p>
<p>Difference between ARG and ENV explained <a href="https://vsupalov.com/docker-arg-vs-env/">here</a>.</p>
<ul>
<li><strong>ARG</strong> values: available only while the image is built.</li>
<li><strong>ENV</strong> values: available for the future running containers.</li>
</ul>
<p><strong>CMD, ENTRYPOINT</strong>: command to execute when generated container starts</p>
<p>The ENTRYPOINT specifies a command that will always be executed when the container starts.
<br>
The CMD specifies arguments that will be fed to the ENTRYPOINT.</p>
<p><br></p>
<p>In the example below, when the container is run without an argument, it will execute <code>echo "hello world"</code> (default).<br>
If it is run with the argument <strong>nice</strong> it will execute <code>echo "nice"</code>.</p>
<pre class="docker"><code>FROM ubuntu:18.04
ENTRYPOINT [&quot;/bin/echo&quot;]
CMD [&quot;hello world&quot;]</code></pre>
<p>A more complex recipe (save it in a text file named <strong>Dockerfile</strong>!):</p>
<pre class="docker"><code>FROM ubuntu:18.04

MAINTAINER Toni Hermoso Pulido &lt;toni.hermoso@crg.eu&gt;

WORKDIR ~

RUN apt-get update &amp;&amp; apt-get -y upgrade
RUN apt-get install -y wget

ENTRYPOINT [&quot;/usr/bin/wget&quot;]
CMD [&quot;https://cdn.wp.nginx.com/wp-content/uploads/2016/07/docker-swarm-hero2.png&quot;]</code></pre>
<center>
<h4 style="background-color: #e6fadc; display: inline-block;">
<strong>HANDS-ON</strong>
</h4>
</center>
<details>
<summary>
<h5 style="background-color: #e6fadc; display: inline-block;">
<em>Answer</em>
</h5>
</summary>
here
</details>
</div>
</div>
<div id="docker-build" class="section level3">
<h3><span class="header-section-number">3.3.2</span> docker build</h3>
<p>Implicitely looks for a <strong>Dockerfile</strong> file in the current directory:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="docker-recipes.html#cb43-1"></a><span class="ex">docker</span> build .</span></code></pre></div>
<p>Same as:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="docker-recipes.html#cb44-1"></a><span class="ex">docker</span> build --file Dockerfile .</span></code></pre></div>
<p>Syntax: <strong>–file / -f</strong></p>
<p><strong>.</strong> stands for the context (in this case, current directory) of the build process. This makes sense if copying files from filesystem, for instance.
<br>
<strong>IMPORTANT</strong>: Avoid contexts (directories) overpopulated with files (even if not actually used in the recipe).</p>
<p>You can define a specific name for the image during the build process.</p>
<p>Syntax: <strong>-t</strong> <em>imagename:tag</em>. If not defined <code>:tag</code> default is latest.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="docker-recipes.html#cb45-1"></a><span class="ex">docker</span> build -t mytestimage .</span></code></pre></div>
<p>The last line of installation should be <strong>Successfully built …</strong>: then you are good to go.
<br>
Check with <code>docker images</code> that you see the newly built image in the list…</p>
<p>Then let’s check the ID of the image and run it!</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="docker-recipes.html#cb46-1"></a><span class="ex">docker</span> images</span>
<span id="cb46-2"><a href="docker-recipes.html#cb46-2"></a></span>
<span id="cb46-3"><a href="docker-recipes.html#cb46-3"></a><span class="ex">docker</span> run f9f41698e2f8</span>
<span id="cb46-4"><a href="docker-recipes.html#cb46-4"></a><span class="ex">docker</span> run mytestimage</span></code></pre></div>
<p>Try to run it with an argument:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="docker-recipes.html#cb47-1"></a><span class="ex">docker</span> run f9f41698e2f8 https://cdn-images-1.medium.com/max/1600/1*_NQN6_YnxS29m8vFzWYlEg.png</span></code></pre></div>
<center>
<h4 style="background-color: #e6fadc; display: inline-block;">
<strong>HANDS-ON</strong>
</h4>
</center>
<ol style="list-style-type: decimal">
<li>Write a docker recipe in a file <strong>Dockerfile_test</strong> that:</li>
</ol>
<ul>
<li>is based on <strong>ubuntu:18.04</strong></li>
<li><strong>echoes “I love containers”</strong> by default or any other word/sentence, if given as the argument.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Build the image (give the image the name of your choice)</li>
<li>Run the image:</li>
</ol>
<ul>
<li>with no argument.</li>
<li>with <strong>“Docker course”</strong> as an argument.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Modify the <strong>Dockerfile_test</strong>:</li>
</ol>
<ul>
<li>add the MAINTAINER field</li>
<li>update and upgrade Ubuntu packages.</li>
<li>install <a href="https://zoomadmin.com/HowToInstall/UbuntuPackage/figlet"><strong>figlet</strong></a></li>
<li>change “echo” to “figlet” in the <strong>ENTRYPOINT</strong></li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Build and run the new image, with the default parameter, then with <strong>“Docker course”</strong> as an argument.</li>
</ol>
<details>
<summary>
<h5 style="background-color: #e6fadc; display: inline-block;">
<em>Answer</em>
</h5>
<p></summary></p>
<ol style="list-style-type: decimal">
<li>Recipe saved in <strong>Dockerfile_test</strong>:</li>
</ol>
<pre><code>FROM ubuntu:18.04
ENTRYPOINT [&quot;echo&quot;]
CMD [&quot;I love containers&quot;]</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Build:</li>
</ol>
<pre><code>docker build --file Dockerfile_test -t mytest .</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Run the image:</li>
</ol>
<pre><code># with no argument
docker run mytest

# with argument &quot;Docker course&quot;
docker run mytest &quot;Docker course&quot;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Recipe:</li>
</ol>
<pre><code>FROM ubuntu:18.04

MAINTAINER Name Surname &lt;name.surname@mail.com&gt;

RUN apt-get update &amp;&amp; apt-get upgrade -y
RUN apt-get install -y figlet

ENTRYPOINT [&quot;figlet&quot;]
CMD [&quot;I love containers&quot;]</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Build and run the new image, with the default parameter, then with <strong>“Docker course”</strong> as an argument.</li>
</ol>
<pre><code># Build
docker build --file Dockerfile_test -t mytest .

# run with no argument
docker run mytest

# run with argument &quot;Docker course&quot;
docker run mytest &quot;Docker course&quot;</code></pre>
</details>
</div>
<div id="docker-tag" class="section level3">
<h3><span class="header-section-number">3.3.3</span> docker tag</h3>
<p>To tag a local image with ID “e23aaea5dff1” into the “ubuntu_wget” image name repository with version “1.0”:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="docker-recipes.html#cb53-1"></a><span class="ex">docker</span> tag e23aaea5dff1 --tag ubuntu_wget:1.0</span></code></pre></div>
<center>
<h4 style="background-color: #e6fadc; display: inline-block;">
<strong>HANDS-ON</strong>
</h4>
</center>
<details>
<summary>
<h5 style="background-color: #e6fadc; display: inline-block;">
<em>Answer</em>
</h5>
</summary>
here
</details>
</div>
<div id="build-cache" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Build cache</h3>
<p>Every line of a Dockerfile is actually an image/layer by itself.</p>
<p>Modify for instance the last bit of the previous image (let’s change the image URL) and rebuild it (even with a different name/tag):</p>
<pre class="docker"><code>FROM ubuntu:18.04

MAINTAINER Toni Hermoso Pulido &lt;toni.hermoso@crg.eu&gt;

WORKDIR ~

RUN apt-get update &amp;&amp; apt-get -y upgrade
RUN apt-get install -y wget

ENTRYPOINT [&quot;/usr/bin/wget&quot;]
CMD [&quot;https://cdn-images-1.medium.com/max/1600/1*_NQN6_YnxS29m8vFzWYlEg.png&quot;]</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="docker-recipes.html#cb55-1"></a><span class="ex">docker</span> build -t mytestimage2 .</span></code></pre></div>
<p>It will start from the last line.
This is OK most of the times and very convenient for testing and trying new steps, but it may lead to errors when versions are updated (either FROM image or included packages). For that it is benefitial to start from scratch with <code>--no-cache</code> tag.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="docker-recipes.html#cb56-1"></a><span class="ex">docker</span> build --no-cache -t mytestimage2 .</span></code></pre></div>
</div>
<div id="more-advanced-image-building" class="section level3">
<h3><span class="header-section-number">3.3.5</span> More advanced image building</h3>
<p>Different ways to build images.</p>
<p>Know your base system and their packages. Popular ones:
* <a href="https://packages.debian.org">Debian</a>
* <a href="https://centos.pkgs.org/">CentOS</a>
* <a href="https://pkgs.alpinelinux.org/packages">Alpine</a>
* Conda. <a href="https://anaconda.org/anaconda/repo">Anaconda</a>, <a href="https://conda-forge.org/feedstocks/">Conda-forge</a>, <a href="https://anaconda.org/bioconda/repo">Bioconda</a>, etc.</p>
</div>
<div id="additional-commands" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Additional commands</h3>
<ul>
<li><p><strong>docker inspect</strong>: Get details from containers (both running and stopped). Things such as IPs, volumes, etc.</p></li>
<li><p><strong>docker logs</strong>: Get <em>console</em> messages from running containers. Useful when using with web services.</p></li>
<li><p><strong>docker commit</strong>: Turn a container into an image. It make senses to use when modifying container interactively. However this is bad for reproducibility if no steps are saved.</p></li>
</ul>
<p>Good for long-term reproducibility and for critical production environments:</p>
<ul>
<li><p><strong>docker save</strong>: Save an image into a tar archive.</p></li>
<li><p><strong>docker export</strong>: Save a container into a tar archive.</p></li>
<li><p><strong>docker import</strong>: Import a tar archive into an image.</p></li>
</ul>
<center>
<h4 style="background-color: #e6fadc; display: inline-block;">
<strong>HANDS-ON</strong>
</h4>
</center>
<details>
<summary>
<h5 style="background-color: #e6fadc; display: inline-block;">
<em>Answer</em>
</h5>
</summary>
here
</details>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-existing-images.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="volumes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["courses_at_crg_2021.pdf", "courses_at_crg_2021.epub"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

</body>

</html>
