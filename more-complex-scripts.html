<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3.7 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</title>
  <meta name="description" content="3.7 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3.7 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3.7 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  
  
  

<meta name="author" content="Sarah Bonnin, Luca Cozzuto, Toni Hermoso, Julia Ponomarenko" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-2.html"/>
<link rel="next" href="exercise-3.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Courses@CRG 2021</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome and about the course</a><ul>
<li class="chapter" data-level="1.1" data-path="meet-the-instructors.html"><a href="meet-the-instructors.html"><i class="fa fa-check"></i><b>1.1</b> Meet the instructors</a></li>
<li class="chapter" data-level="1.2" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i><b>1.2</b> About the course</a><ul>
<li class="chapter" data-level="1.2.1" data-path="about-the-course.html"><a href="about-the-course.html#outline"><i class="fa fa-check"></i><b>1.2.1</b> Outline</a></li>
<li class="chapter" data-level="1.2.2" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i><b>1.2.2</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2.3" data-path="about-the-course.html"><a href="about-the-course.html#prerequisite-dates-time-location"><i class="fa fa-check"></i><b>1.2.3</b> Prerequisite, Dates, time, location</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1.3</b> Program</a><ul>
<li class="chapter" data-level="1.3.1" data-path="program.html"><a href="program.html#may-3-4-containers"><i class="fa fa-check"></i><b>1.3.1</b> May 3-4: Containers</a></li>
<li class="chapter" data-level="1.3.2" data-path="program.html"><a href="program.html#may-10-11-nextflow"><i class="fa fa-check"></i><b>1.3.2</b> May 10-11: Nextflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="containers.html"><a href="containers.html"><i class="fa fa-check"></i><b>2</b> Containers</a></li>
<li class="chapter" data-level="3" data-path="nextflow.html"><a href="nextflow.html"><i class="fa fa-check"></i><b>3</b> Nextflow</a><ul>
<li class="chapter" data-level="3.1" data-path="what-is-nextflow.html"><a href="what-is-nextflow.html"><i class="fa fa-check"></i><b>3.1</b> What is Nextflow?</a></li>
<li class="chapter" data-level="3.2" data-path="workflow-structure-and-installation.html"><a href="workflow-structure-and-installation.html"><i class="fa fa-check"></i><b>3.2</b> Workflow structure and Installation</a><ul>
<li class="chapter" data-level="3.2.1" data-path="workflow-structure-and-installation.html"><a href="workflow-structure-and-installation.html#installation"><i class="fa fa-check"></i><b>3.2.1</b> Installation</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="first-scripts.html"><a href="first-scripts.html"><i class="fa fa-check"></i><b>3.3</b> First scripts</a><ul>
<li class="chapter" data-level="3.3.1" data-path="first-scripts.html"><a href="first-scripts.html#channels"><i class="fa fa-check"></i><b>3.3.1</b> Channels</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i><b>3.4</b> EXERCISE 1</a></li>
<li class="chapter" data-level="3.5" data-path="processes.html"><a href="processes.html"><i class="fa fa-check"></i><b>3.5</b> Processes</a><ul>
<li class="chapter" data-level="3.5.1" data-path="processes.html"><a href="processes.html#workflow"><i class="fa fa-check"></i><b>3.5.1</b> Workflow</a></li>
<li class="chapter" data-level="3.5.2" data-path="processes.html"><a href="processes.html#nextflow-log"><i class="fa fa-check"></i><b>3.5.2</b> Nextflow log</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i><b>3.6</b> EXERCISE 2</a></li>
<li class="chapter" data-level="3.7" data-path="more-complex-scripts.html"><a href="more-complex-scripts.html"><i class="fa fa-check"></i><b>3.7</b> More complex scripts</a></li>
<li class="chapter" data-level="3.8" data-path="exercise-3.html"><a href="exercise-3.html"><i class="fa fa-check"></i><b>3.8</b> EXERCISE 3</a></li>
<li class="chapter" data-level="3.9" data-path="resuming-your-pipeline.html"><a href="resuming-your-pipeline.html"><i class="fa fa-check"></i><b>3.9</b> Resuming your pipeline</a></li>
<li class="chapter" data-level="3.10" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html"><i class="fa fa-check"></i><b>3.10</b> Decoupling resources, parameters and nextflow script</a><ul>
<li class="chapter" data-level="3.10.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html#publishing-final-results"><i class="fa fa-check"></i><b>3.10.1</b> Publishing final results</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="adding-a-help-section-for-the-whole-pipeline.html"><a href="adding-a-help-section-for-the-whole-pipeline.html"><i class="fa fa-check"></i><b>3.11</b> Adding a help section for the whole pipeline</a></li>
<li class="chapter" data-level="3.12" data-path="using-singularity.html"><a href="using-singularity.html"><i class="fa fa-check"></i><b>3.12</b> Using Singularity</a></li>
<li class="chapter" data-level="3.13" data-path="adding-more-steps.html"><a href="adding-more-steps.html"><i class="fa fa-check"></i><b>3.13</b> Adding more steps</a></li>
<li class="chapter" data-level="3.14" data-path="modules-and-re-usage-of-the-code.html"><a href="modules-and-re-usage-of-the-code.html"><i class="fa fa-check"></i><b>3.14</b> Modules and re-usage of the code</a></li>
<li class="chapter" data-level="3.15" data-path="exercise-4.html"><a href="exercise-4.html"><i class="fa fa-check"></i><b>3.15</b> EXERCISE 4</a></li>
<li class="chapter" data-level="3.16" data-path="reporting-and-graphical-interface.html"><a href="reporting-and-graphical-interface.html"><i class="fa fa-check"></i><b>3.16</b> Reporting and graphical interface</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://biocore.crg.eu/wiki/Main_Page" target="blank">BIOINFORMATICS CORE @ CRG</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="more-complex-scripts" class="section level2">
<h2><span class="header-section-number">3.7</span> More complex scripts</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb24-1"><a href="more-complex-scripts.html#cb24-1"></a>#!/usr/bin/env nextflow</span>
<span id="cb24-2"><a href="more-complex-scripts.html#cb24-2"></a></span>
<span id="cb24-3"><a href="more-complex-scripts.html#cb24-3"></a>nextflow.<span class="fu">enable</span>.<span class="fu">dsl</span>=<span class="dv">2</span></span>
<span id="cb24-4"><a href="more-complex-scripts.html#cb24-4"></a></span>
<span id="cb24-5"><a href="more-complex-scripts.html#cb24-5"></a><span class="co">// this can be overridden by using --inputfile OTHERFILENAME</span></span>
<span id="cb24-6"><a href="more-complex-scripts.html#cb24-6"></a>params.<span class="fu">inputfile</span> = <span class="st">&quot;$baseDir/testdata/test.fa&quot;</span></span>
<span id="cb24-7"><a href="more-complex-scripts.html#cb24-7"></a></span>
<span id="cb24-8"><a href="more-complex-scripts.html#cb24-8"></a><span class="co">// the &quot;file method&quot; returns a file system object given a file path string  </span></span>
<span id="cb24-9"><a href="more-complex-scripts.html#cb24-9"></a>sequences_file = <span class="fu">file</span>(params.<span class="fu">inputfile</span>)             </span>
<span id="cb24-10"><a href="more-complex-scripts.html#cb24-10"></a></span>
<span id="cb24-11"><a href="more-complex-scripts.html#cb24-11"></a><span class="co">// check if the file exists</span></span>
<span id="cb24-12"><a href="more-complex-scripts.html#cb24-12"></a><span class="kw">if</span>( !sequences_file.<span class="fu">exists</span>() ) exit <span class="dv">1</span>, <span class="st">&quot;Missing genome file: ${genome_file}&quot;</span></span>
<span id="cb24-13"><a href="more-complex-scripts.html#cb24-13"></a></span>
<span id="cb24-14"><a href="more-complex-scripts.html#cb24-14"></a></span>
<span id="cb24-15"><a href="more-complex-scripts.html#cb24-15"></a><span class="co">/*</span></span>
<span id="cb24-16"><a href="more-complex-scripts.html#cb24-16"></a><span class="co"> * Process 1 for splitting a fasta file in multiple files</span></span>
<span id="cb24-17"><a href="more-complex-scripts.html#cb24-17"></a><span class="co"> */</span></span>
<span id="cb24-18"><a href="more-complex-scripts.html#cb24-18"></a></span>
<span id="cb24-19"><a href="more-complex-scripts.html#cb24-19"></a>process splitSequences {</span>
<span id="cb24-20"><a href="more-complex-scripts.html#cb24-20"></a></span>
<span id="cb24-21"><a href="more-complex-scripts.html#cb24-21"></a>    input:</span>
<span id="cb24-22"><a href="more-complex-scripts.html#cb24-22"></a>    path sequencesFile</span>
<span id="cb24-23"><a href="more-complex-scripts.html#cb24-23"></a></span>
<span id="cb24-24"><a href="more-complex-scripts.html#cb24-24"></a>    output:</span>
<span id="cb24-25"><a href="more-complex-scripts.html#cb24-25"></a>    <span class="fu">path</span> (&#39;seq_*&#39;)    </span>
<span id="cb24-26"><a href="more-complex-scripts.html#cb24-26"></a></span>
<span id="cb24-27"><a href="more-complex-scripts.html#cb24-27"></a>    <span class="co">// simple awk command</span></span>
<span id="cb24-28"><a href="more-complex-scripts.html#cb24-28"></a>    script:</span>
<span id="cb24-29"><a href="more-complex-scripts.html#cb24-29"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb24-30"><a href="more-complex-scripts.html#cb24-30"></a>    awk &#39;/^&gt;/{f=<span class="st">&quot;seq_&quot;</span>++d} {print &gt; f}&#39; &lt; ${sequencesFile}</span>
<span id="cb24-31"><a href="more-complex-scripts.html#cb24-31"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb24-32"><a href="more-complex-scripts.html#cb24-32"></a>}</span>
<span id="cb24-33"><a href="more-complex-scripts.html#cb24-33"></a></span>
<span id="cb24-34"><a href="more-complex-scripts.html#cb24-34"></a></span>
<span id="cb24-35"><a href="more-complex-scripts.html#cb24-35"></a><span class="co">/*</span></span>
<span id="cb24-36"><a href="more-complex-scripts.html#cb24-36"></a><span class="co"> * Process 2 for reversing the sequences</span></span>
<span id="cb24-37"><a href="more-complex-scripts.html#cb24-37"></a><span class="co"> */</span></span>
<span id="cb24-38"><a href="more-complex-scripts.html#cb24-38"></a></span>
<span id="cb24-39"><a href="more-complex-scripts.html#cb24-39"></a>process reverseSequence {</span>
<span id="cb24-40"><a href="more-complex-scripts.html#cb24-40"></a>    tag <span class="st">&quot;$seq&quot;</span>                  </span>
<span id="cb24-41"><a href="more-complex-scripts.html#cb24-41"></a>    publishDir <span class="st">&quot;output&quot;</span></span>
<span id="cb24-42"><a href="more-complex-scripts.html#cb24-42"></a></span>
<span id="cb24-43"><a href="more-complex-scripts.html#cb24-43"></a>    input:</span>
<span id="cb24-44"><a href="more-complex-scripts.html#cb24-44"></a>    path seq</span>
<span id="cb24-45"><a href="more-complex-scripts.html#cb24-45"></a></span>
<span id="cb24-46"><a href="more-complex-scripts.html#cb24-46"></a>    output:</span>
<span id="cb24-47"><a href="more-complex-scripts.html#cb24-47"></a>    path <span class="st">&quot;all.rev&quot;</span></span>
<span id="cb24-48"><a href="more-complex-scripts.html#cb24-48"></a></span>
<span id="cb24-49"><a href="more-complex-scripts.html#cb24-49"></a>    script:</span>
<span id="cb24-50"><a href="more-complex-scripts.html#cb24-50"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb24-51"><a href="more-complex-scripts.html#cb24-51"></a>    cat ${seq} | awk &#39;{<span class="kw">if</span> (\$<span class="dv">1</span>~<span class="st">&quot;&gt;&quot;</span>) {print \$<span class="dv">0</span>} <span class="kw">else</span> <span class="fu">system</span>(<span class="st">&quot;echo &quot;</span> \$<span class="dv">0</span> <span class="st">&quot; |rev&quot;</span>)}&#39; &gt; all.<span class="fu">rev</span></span>
<span id="cb24-52"><a href="more-complex-scripts.html#cb24-52"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb24-53"><a href="more-complex-scripts.html#cb24-53"></a>}</span>
<span id="cb24-54"><a href="more-complex-scripts.html#cb24-54"></a></span>
<span id="cb24-55"><a href="more-complex-scripts.html#cb24-55"></a>workflow {</span>
<span id="cb24-56"><a href="more-complex-scripts.html#cb24-56"></a>    splitted_seq    = <span class="fu">splitSequences</span>(sequences_file)</span>
<span id="cb24-57"><a href="more-complex-scripts.html#cb24-57"></a></span>
<span id="cb24-58"><a href="more-complex-scripts.html#cb24-58"></a>    <span class="co">// Here you have the output channel as a collection</span></span>
<span id="cb24-59"><a href="more-complex-scripts.html#cb24-59"></a>    splitted_seq.<span class="fu">view</span>()</span>
<span id="cb24-60"><a href="more-complex-scripts.html#cb24-60"></a></span>
<span id="cb24-61"><a href="more-complex-scripts.html#cb24-61"></a>    <span class="co">// Here you have the same channel reshaped to send separately each value</span></span>
<span id="cb24-62"><a href="more-complex-scripts.html#cb24-62"></a>    splitted_seq.<span class="fu">flatten</span>().<span class="fu">view</span>()</span>
<span id="cb24-63"><a href="more-complex-scripts.html#cb24-63"></a></span>
<span id="cb24-64"><a href="more-complex-scripts.html#cb24-64"></a>    <span class="co">// DLS2 allows you to reuse the channels! In past you had to create many identical</span></span>
<span id="cb24-65"><a href="more-complex-scripts.html#cb24-65"></a>    <span class="co">// channels for sending the same kind of data to different processes</span></span>
<span id="cb24-66"><a href="more-complex-scripts.html#cb24-66"></a></span>
<span id="cb24-67"><a href="more-complex-scripts.html#cb24-67"></a>    rev_single_seq  = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb24-68"><a href="more-complex-scripts.html#cb24-68"></a>}</span></code></pre></div>
<p>Here we have two simple processes:</p>
<ul>
<li>the former splits the input fasta file in single sequences</li>
<li>the latter is able to reverse the position of the sequences.</li>
</ul>
<p>The input path is fed as a parameter using the script parameters **${seq}*</p>
<pre><code>params.inputfile</code></pre>
<p>In this way this value can be overridden when calling the script in this way:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="more-complex-scripts.html#cb26-1"></a><span class="ex">nextflow</span> run test.nf --inputfile another_input.fa</span></code></pre></div>
<p>The workflow part connects the two processes so that the output of the first process is fed to the second one.</p>
<p>During the execution Nextflow creates a number of temporary folders and this time will make also a soft link to the original input file. Then it will store output files locally.</p>
<p>The output file is then linked in other folders for being used as input from other processes. In this way there are no clashes and each process is nicely isolated from the others.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="more-complex-scripts.html#cb27-1"></a><span class="ex">nextflow</span> run test.nf -bg</span>
<span id="cb27-2"><a href="more-complex-scripts.html#cb27-2"></a><span class="ex">N</span> E X T F L O W  ~  version 20.07.1</span>
<span id="cb27-3"><a href="more-complex-scripts.html#cb27-3"></a><span class="ex">Launching</span> <span class="kw">`</span><span class="ex">test.nf</span><span class="kw">`</span> [sad_newton] - revision: 82e66714e4</span>
<span id="cb27-4"><a href="more-complex-scripts.html#cb27-4"></a>[<span class="ex">09</span>/<span class="ex">53e071</span>] Submitted process <span class="op">&gt;</span> splitSequences</span>
<span id="cb27-5"><a href="more-complex-scripts.html#cb27-5"></a>[<span class="ex">/Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59</span>/<span class="ex">seq_1</span>, /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2, /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3]</span>
<span id="cb27-6"><a href="more-complex-scripts.html#cb27-6"></a><span class="ex">/Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_1</span></span>
<span id="cb27-7"><a href="more-complex-scripts.html#cb27-7"></a><span class="ex">/Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2</span></span>
<span id="cb27-8"><a href="more-complex-scripts.html#cb27-8"></a><span class="ex">/Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3</span></span>
<span id="cb27-9"><a href="more-complex-scripts.html#cb27-9"></a>[<span class="ex">fe</span>/<span class="ex">0a8640</span>] Submitted process <span class="op">&gt;</span> reverseSequence ([seq_1, seq_2, seq_3])</span></code></pre></div>
<p>if we inspect the content of work/09/53e071* generated by the process <strong>splitSequences</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="more-complex-scripts.html#cb28-1"></a><span class="fu">ls</span> -l work/09/53e071*</span>
<span id="cb28-2"><a href="more-complex-scripts.html#cb28-2"></a><span class="ex">total</span> 24</span>
<span id="cb28-3"><a href="more-complex-scripts.html#cb28-3"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  29 Oct  8 19:16 seq_1</span>
<span id="cb28-4"><a href="more-complex-scripts.html#cb28-4"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  33 Oct  8 19:16 seq_2</span>
<span id="cb28-5"><a href="more-complex-scripts.html#cb28-5"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  27 Oct  8 19:16 seq_3</span>
<span id="cb28-6"><a href="more-complex-scripts.html#cb28-6"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  69 Oct  8 19:16 test.fa -<span class="op">&gt;</span> /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/testdata/test.fa</span></code></pre></div>
<p>we have the file test.fa that is a soft link to the orinal input. And inspecting work/fe/0a8640* that is generated by the process <strong>reverseSequence</strong> reveals that the files generated by <strong>splitSequences</strong> are now linked as input.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="more-complex-scripts.html#cb29-1"></a><span class="fu">ls</span> -l work/fe/0a8640*</span>
<span id="cb29-2"><a href="more-complex-scripts.html#cb29-2"></a><span class="ex">total</span> 8</span>
<span id="cb29-3"><a href="more-complex-scripts.html#cb29-3"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  89 Oct  8 19:16 all.rev</span>
<span id="cb29-4"><a href="more-complex-scripts.html#cb29-4"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_1 -<span class="op">&gt;</span> /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_1</span>
<span id="cb29-5"><a href="more-complex-scripts.html#cb29-5"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_2 -<span class="op">&gt;</span> /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2</span>
<span id="cb29-6"><a href="more-complex-scripts.html#cb29-6"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_3 -<span class="op">&gt;</span> /Users/lcozzuto/aaa/ELIXIR_containers_nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3</span></code></pre></div>
<p><strong>IMPORTANT: Nextflow will randomly generate temporary folders so they will be named differently in your execution!!!</strong></p>
<p>At this point we can make two different workflows so that we show how the new DSL allows reusing of the code.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb30-1"><a href="more-complex-scripts.html#cb30-1"></a>#!/usr/bin/env nextflow</span>
<span id="cb30-2"><a href="more-complex-scripts.html#cb30-2"></a></span>
<span id="cb30-3"><a href="more-complex-scripts.html#cb30-3"></a>nextflow.<span class="fu">enable</span>.<span class="fu">dsl</span>=<span class="dv">2</span></span>
<span id="cb30-4"><a href="more-complex-scripts.html#cb30-4"></a></span>
<span id="cb30-5"><a href="more-complex-scripts.html#cb30-5"></a><span class="co">// this can be overridden by using --inputfile OTHERFILENAME</span></span>
<span id="cb30-6"><a href="more-complex-scripts.html#cb30-6"></a>params.<span class="fu">inputfile</span> = <span class="st">&quot;$baseDir/testdata/test.fa&quot;</span></span>
<span id="cb30-7"><a href="more-complex-scripts.html#cb30-7"></a></span>
<span id="cb30-8"><a href="more-complex-scripts.html#cb30-8"></a><span class="co">// the &quot;file method&quot; returns a file system object given a file path string  </span></span>
<span id="cb30-9"><a href="more-complex-scripts.html#cb30-9"></a>sequences_file = <span class="fu">file</span>(params.<span class="fu">inputfile</span>)             </span>
<span id="cb30-10"><a href="more-complex-scripts.html#cb30-10"></a></span>
<span id="cb30-11"><a href="more-complex-scripts.html#cb30-11"></a><span class="co">// check if the file exists</span></span>
<span id="cb30-12"><a href="more-complex-scripts.html#cb30-12"></a><span class="kw">if</span>( !sequences_file.<span class="fu">exists</span>() ) exit <span class="dv">1</span>, <span class="st">&quot;Missing genome file: ${genome_file}&quot;</span></span>
<span id="cb30-13"><a href="more-complex-scripts.html#cb30-13"></a></span>
<span id="cb30-14"><a href="more-complex-scripts.html#cb30-14"></a></span>
<span id="cb30-15"><a href="more-complex-scripts.html#cb30-15"></a><span class="co">/*</span></span>
<span id="cb30-16"><a href="more-complex-scripts.html#cb30-16"></a><span class="co"> * Process 1 for splitting a fasta file in multiple files</span></span>
<span id="cb30-17"><a href="more-complex-scripts.html#cb30-17"></a><span class="co"> */</span></span>
<span id="cb30-18"><a href="more-complex-scripts.html#cb30-18"></a></span>
<span id="cb30-19"><a href="more-complex-scripts.html#cb30-19"></a>process splitSequences {</span>
<span id="cb30-20"><a href="more-complex-scripts.html#cb30-20"></a></span>
<span id="cb30-21"><a href="more-complex-scripts.html#cb30-21"></a>    input:</span>
<span id="cb30-22"><a href="more-complex-scripts.html#cb30-22"></a>    path sequencesFile</span>
<span id="cb30-23"><a href="more-complex-scripts.html#cb30-23"></a></span>
<span id="cb30-24"><a href="more-complex-scripts.html#cb30-24"></a>    output:</span>
<span id="cb30-25"><a href="more-complex-scripts.html#cb30-25"></a>    <span class="fu">path</span> (&#39;seq_*&#39;)    </span>
<span id="cb30-26"><a href="more-complex-scripts.html#cb30-26"></a></span>
<span id="cb30-27"><a href="more-complex-scripts.html#cb30-27"></a>    <span class="co">// simple awk command</span></span>
<span id="cb30-28"><a href="more-complex-scripts.html#cb30-28"></a></span>
<span id="cb30-29"><a href="more-complex-scripts.html#cb30-29"></a>    script:</span>
<span id="cb30-30"><a href="more-complex-scripts.html#cb30-30"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-31"><a href="more-complex-scripts.html#cb30-31"></a>    awk &#39;/^&gt;/{f=<span class="st">&quot;seq_&quot;</span>++d} {print &gt; f}&#39; &lt; ${sequencesFile}</span>
<span id="cb30-32"><a href="more-complex-scripts.html#cb30-32"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-33"><a href="more-complex-scripts.html#cb30-33"></a>}</span>
<span id="cb30-34"><a href="more-complex-scripts.html#cb30-34"></a></span>
<span id="cb30-35"><a href="more-complex-scripts.html#cb30-35"></a></span>
<span id="cb30-36"><a href="more-complex-scripts.html#cb30-36"></a><span class="co">/*</span></span>
<span id="cb30-37"><a href="more-complex-scripts.html#cb30-37"></a><span class="co"> * Process 2 for reversing the sequences</span></span>
<span id="cb30-38"><a href="more-complex-scripts.html#cb30-38"></a><span class="co"> */</span></span>
<span id="cb30-39"><a href="more-complex-scripts.html#cb30-39"></a></span>
<span id="cb30-40"><a href="more-complex-scripts.html#cb30-40"></a>process reverseSequence {</span>
<span id="cb30-41"><a href="more-complex-scripts.html#cb30-41"></a>    tag <span class="st">&quot;$seq&quot;</span>                  </span>
<span id="cb30-42"><a href="more-complex-scripts.html#cb30-42"></a>    publishDir <span class="st">&quot;output&quot;</span></span>
<span id="cb30-43"><a href="more-complex-scripts.html#cb30-43"></a></span>
<span id="cb30-44"><a href="more-complex-scripts.html#cb30-44"></a>    input:</span>
<span id="cb30-45"><a href="more-complex-scripts.html#cb30-45"></a>    path seq</span>
<span id="cb30-46"><a href="more-complex-scripts.html#cb30-46"></a></span>
<span id="cb30-47"><a href="more-complex-scripts.html#cb30-47"></a>    output:</span>
<span id="cb30-48"><a href="more-complex-scripts.html#cb30-48"></a>    path <span class="st">&quot;all.rev&quot;</span></span>
<span id="cb30-49"><a href="more-complex-scripts.html#cb30-49"></a></span>
<span id="cb30-50"><a href="more-complex-scripts.html#cb30-50"></a>    script:</span>
<span id="cb30-51"><a href="more-complex-scripts.html#cb30-51"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-52"><a href="more-complex-scripts.html#cb30-52"></a>    cat ${seq} | awk &#39;{<span class="kw">if</span> (\$<span class="dv">1</span>~<span class="st">&quot;&gt;&quot;</span>) {print \$<span class="dv">0</span>} <span class="kw">else</span> <span class="fu">system</span>(<span class="st">&quot;echo &quot;</span> \$<span class="dv">0</span> <span class="st">&quot; |rev&quot;</span>)}&#39; &gt; all.<span class="fu">rev</span></span>
<span id="cb30-53"><a href="more-complex-scripts.html#cb30-53"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb30-54"><a href="more-complex-scripts.html#cb30-54"></a>}</span>
<span id="cb30-55"><a href="more-complex-scripts.html#cb30-55"></a></span>
<span id="cb30-56"><a href="more-complex-scripts.html#cb30-56"></a>workflow flow1 {</span>
<span id="cb30-57"><a href="more-complex-scripts.html#cb30-57"></a>    take: sequences</span>
<span id="cb30-58"><a href="more-complex-scripts.html#cb30-58"></a>    main:</span>
<span id="cb30-59"><a href="more-complex-scripts.html#cb30-59"></a>    splitted_seq        = <span class="fu">splitSequences</span>(sequences)</span>
<span id="cb30-60"><a href="more-complex-scripts.html#cb30-60"></a>    rev_single_seq      = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb30-61"><a href="more-complex-scripts.html#cb30-61"></a>}</span>
<span id="cb30-62"><a href="more-complex-scripts.html#cb30-62"></a></span>
<span id="cb30-63"><a href="more-complex-scripts.html#cb30-63"></a>workflow flow2 {</span>
<span id="cb30-64"><a href="more-complex-scripts.html#cb30-64"></a>    take: sequences</span>
<span id="cb30-65"><a href="more-complex-scripts.html#cb30-65"></a>    main:</span>
<span id="cb30-66"><a href="more-complex-scripts.html#cb30-66"></a>    splitted_seq        = <span class="fu">splitSequences</span>(sequences).<span class="fu">flatten</span>()</span>
<span id="cb30-67"><a href="more-complex-scripts.html#cb30-67"></a>    rev_single_seq      = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb30-68"><a href="more-complex-scripts.html#cb30-68"></a></span>
<span id="cb30-69"><a href="more-complex-scripts.html#cb30-69"></a>}</span>
<span id="cb30-70"><a href="more-complex-scripts.html#cb30-70"></a></span>
<span id="cb30-71"><a href="more-complex-scripts.html#cb30-71"></a>workflow {</span>
<span id="cb30-72"><a href="more-complex-scripts.html#cb30-72"></a>   <span class="fu">flow1</span>(sequences_file)</span>
<span id="cb30-73"><a href="more-complex-scripts.html#cb30-73"></a>   <span class="fu">flow2</span>(sequences_file)</span>
<span id="cb30-74"><a href="more-complex-scripts.html#cb30-74"></a>}</span></code></pre></div>
<p>The first workflow will just run like the previous script, while the second will “flatten” the output of the first process and will launch the second process on each single sequence.</p>
<p>The <strong>reverseSequence</strong> processes of the second workflow will run in parallel if you have enough processors or you are in a cluster environment with a scheduler supported by Nextflow.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="more-complex-scripts.html#cb31-1"></a><span class="ex">nextflow</span> run test.nf -bg</span>
<span id="cb31-2"><a href="more-complex-scripts.html#cb31-2"></a><span class="ex">C02WX1XFHV2Q</span>:nextflow lcozzuto$ N E X T F L O W  ~  version 20.07.1</span>
<span id="cb31-3"><a href="more-complex-scripts.html#cb31-3"></a><span class="ex">Launching</span> <span class="kw">`</span><span class="ex">test.nf</span><span class="kw">`</span> [insane_plateau] - revision: d33befe154</span>
<span id="cb31-4"><a href="more-complex-scripts.html#cb31-4"></a>[<span class="ex">bd</span>/<span class="ex">f4e9a6</span>] Submitted process <span class="op">&gt;</span> flow1:splitSequences</span>
<span id="cb31-5"><a href="more-complex-scripts.html#cb31-5"></a>[<span class="ex">37</span>/<span class="ex">d790ab</span>] Submitted process <span class="op">&gt;</span> flow2:splitSequences</span>
<span id="cb31-6"><a href="more-complex-scripts.html#cb31-6"></a>[<span class="ex">33</span>/<span class="ex">a6fc72</span>] Submitted process <span class="op">&gt;</span> flow1:reverseSequence ([seq_1, seq_2, seq_3])</span>
<span id="cb31-7"><a href="more-complex-scripts.html#cb31-7"></a>[<span class="ex">87</span>/<span class="ex">54bfe8</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_2)</span>
<span id="cb31-8"><a href="more-complex-scripts.html#cb31-8"></a>[<span class="ex">45</span>/<span class="ex">86dd83</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_1)</span>
<span id="cb31-9"><a href="more-complex-scripts.html#cb31-9"></a>[<span class="ex">93</span>/<span class="ex">c7b1c6</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_3)</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["courses_at_crg_2021.pdf", "courses_at_crg_2021.epub"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

</body>

</html>
