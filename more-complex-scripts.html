<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.12 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</title>
  <meta name="description" content="5.12 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="5.12 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.12 More complex scripts | Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines" />
  
  
  

<meta name="author" content="Sarah Bonnin, Luca Cozzuto, Toni Hermoso, Julia Ponomarenko" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-2.html"/>
<link rel="next" href="directives.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Courses@CRG 2021</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome and about the course</a><ul>
<li class="chapter" data-level="1.1" data-path="meet-the-organizers-and-instructors.html"><a href="meet-the-organizers-and-instructors.html"><i class="fa fa-check"></i><b>1.1</b> Meet the organizers and instructors</a></li>
<li class="chapter" data-level="1.2" data-path="about-the-course.html"><a href="about-the-course.html"><i class="fa fa-check"></i><b>1.2</b> About the course</a><ul>
<li class="chapter" data-level="1.2.1" data-path="about-the-course.html"><a href="about-the-course.html#outline"><i class="fa fa-check"></i><b>1.2.1</b> Outline</a></li>
<li class="chapter" data-level="1.2.2" data-path="about-the-course.html"><a href="about-the-course.html#learning-objectives"><i class="fa fa-check"></i><b>1.2.2</b> Learning objectives</a></li>
<li class="chapter" data-level="1.2.3" data-path="about-the-course.html"><a href="about-the-course.html#prerequisite-technical-requirements"><i class="fa fa-check"></i><b>1.2.3</b> Prerequisite / technical requirements</a></li>
<li class="chapter" data-level="1.2.4" data-path="about-the-course.html"><a href="about-the-course.html#dates-time-location"><i class="fa fa-check"></i><b>1.2.4</b> Dates, time, location</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1.3</b> Program</a><ul>
<li class="chapter" data-level="1.3.1" data-path="program.html"><a href="program.html#may-3-4-containers"><i class="fa fa-check"></i><b>1.3.1</b> May 3-4: Containers</a></li>
<li class="chapter" data-level="1.3.2" data-path="program.html"><a href="program.html#may-10-11-nextflow"><i class="fa fa-check"></i><b>1.3.2</b> May 10-11: Nextflow</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-containers.html"><a href="introduction-to-containers.html"><i class="fa fa-check"></i><b>2</b> Introduction to containers</a><ul>
<li class="chapter" data-level="2.1" data-path="what-are-containers.html"><a href="what-are-containers.html"><i class="fa fa-check"></i><b>2.1</b> What are containers ?</a></li>
<li class="chapter" data-level="2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html"><i class="fa fa-check"></i><b>2.2</b> Virtual machines or containers ?</a><ul>
<li class="chapter" data-level="2.2.1" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtualisation"><i class="fa fa-check"></i><b>2.2.1</b> Virtualisation</a></li>
<li class="chapter" data-level="2.2.2" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#containerisation-aka-lightweight-virtualisation"><i class="fa fa-check"></i><b>2.2.2</b> Containerisation (aka lightweight virtualisation)</a></li>
<li class="chapter" data-level="2.2.3" data-path="virtual-machines-or-containers.html"><a href="virtual-machines-or-containers.html#virtual-machines-vs-containers"><i class="fa fa-check"></i><b>2.2.3</b> Virtual machines vs containers</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="history-of-containers.html"><a href="history-of-containers.html"><i class="fa fa-check"></i><b>2.3</b> History of containers</a><ul>
<li class="chapter" data-level="2.3.1" data-path="history-of-containers.html"><a href="history-of-containers.html#chroot"><i class="fa fa-check"></i><b>2.3.1</b> chroot</a></li>
<li class="chapter" data-level="2.3.2" data-path="history-of-containers.html"><a href="history-of-containers.html#additions-in-linux-kernel"><i class="fa fa-check"></i><b>2.3.2</b> Additions in Linux kernel</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="docker.html"><a href="docker.html"><i class="fa fa-check"></i><b>3</b> Docker</a><ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html"><i class="fa fa-check"></i><b>3.1</b> Introduction to Docker</a><ul>
<li class="chapter" data-level="3.1.1" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#what-is-docker"><i class="fa fa-check"></i><b>3.1.1</b> What is Docker?</a></li>
<li class="chapter" data-level="3.1.2" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-components"><i class="fa fa-check"></i><b>3.1.2</b> Docker components</a></li>
<li class="chapter" data-level="3.1.3" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#images-versus-containers"><i class="fa fa-check"></i><b>3.1.3</b> Images versus containers</a></li>
<li class="chapter" data-level="3.1.4" data-path="introduction-to-docker.html"><a href="introduction-to-docker.html#docker-vocabulary"><i class="fa fa-check"></i><b>3.1.4</b> Docker vocabulary</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="using-existing-images.html"><a href="using-existing-images.html"><i class="fa fa-check"></i><b>3.2</b> Using existing images</a><ul>
<li class="chapter" data-level="3.2.1" data-path="using-existing-images.html"><a href="using-existing-images.html#getting-started"><i class="fa fa-check"></i><b>3.2.1</b> Getting started</a></li>
<li class="chapter" data-level="3.2.2" data-path="using-existing-images.html"><a href="using-existing-images.html#explore-docker-hub"><i class="fa fa-check"></i><b>3.2.2</b> Explore Docker hub</a></li>
<li class="chapter" data-level="3.2.3" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-pull-import-an-image"><i class="fa fa-check"></i><b>3.2.3</b> docker pull: import an image</a></li>
<li class="chapter" data-level="3.2.4" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-run-run-image-i.e.-start-a-container"><i class="fa fa-check"></i><b>3.2.4</b> docker run: run image, i.e. start a container</a></li>
<li class="chapter" data-level="3.2.5" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-ps-check-containers-status"><i class="fa fa-check"></i><b>3.2.5</b> docker ps: check containers status</a></li>
<li class="chapter" data-level="3.2.6" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-exec-execute-process-in-running-container"><i class="fa fa-check"></i><b>3.2.6</b> docker exec: execute process in running container</a></li>
<li class="chapter" data-level="3.2.7" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-stop-start-restart-actions-on-container"><i class="fa fa-check"></i><b>3.2.7</b> docker stop, start, restart: actions on container</a></li>
<li class="chapter" data-level="3.2.8" data-path="using-existing-images.html"><a href="using-existing-images.html#docker-rm-docker-rmi-clean-up"><i class="fa fa-check"></i><b>3.2.8</b> docker rm, docker rmi: clean up!</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="exercise-1-docker-as-a-user.html"><a href="exercise-1-docker-as-a-user.html"><i class="fa fa-check"></i><b>3.3</b> Exercise 1 - Docker as a user</a></li>
<li class="chapter" data-level="3.4" data-path="linux-packages.html"><a href="linux-packages.html"><i class="fa fa-check"></i><b>3.4</b> Linux packages</a><ul>
<li class="chapter" data-level="3.4.1" data-path="linux-packages.html"><a href="linux-packages.html#update-and-upgrade-packages"><i class="fa fa-check"></i><b>3.4.1</b> Update and upgrade packages</a></li>
<li class="chapter" data-level="3.4.2" data-path="linux-packages.html"><a href="linux-packages.html#search-and-install-packages"><i class="fa fa-check"></i><b>3.4.2</b> Search and install packages:</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="docker-recipes.html"><a href="docker-recipes.html"><i class="fa fa-check"></i><b>3.5</b> Docker recipes</a><ul>
<li class="chapter" data-level="3.5.1" data-path="docker-recipes.html"><a href="docker-recipes.html#writing-recipes-and-building-images"><i class="fa fa-check"></i><b>3.5.1</b> Writing recipes and building images</a></li>
<li class="chapter" data-level="3.5.2" data-path="docker-recipes.html"><a href="docker-recipes.html#docker-tag"><i class="fa fa-check"></i><b>3.5.2</b> docker tag</a></li>
<li class="chapter" data-level="3.5.3" data-path="docker-recipes.html"><a href="docker-recipes.html#build-cache"><i class="fa fa-check"></i><b>3.5.3</b> Build cache</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="exercise-2-docker-recipes-and-build-images.html"><a href="exercise-2-docker-recipes-and-build-images.html"><i class="fa fa-check"></i><b>3.6</b> Exercise 2 - Docker recipes and build images</a><ul>
<li class="chapter" data-level="3.6.1" data-path="exercise-2-docker-recipes-and-build-images.html"><a href="exercise-2-docker-recipes-and-build-images.html#additional-commands"><i class="fa fa-check"></i><b>3.6.1</b> Additional commands</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="volumes.html"><a href="volumes.html"><i class="fa fa-check"></i><b>3.7</b> Volumes</a></li>
<li class="chapter" data-level="3.8" data-path="ports.html"><a href="ports.html"><i class="fa fa-check"></i><b>3.8</b> Ports</a></li>
<li class="chapter" data-level="3.9" data-path="integrative-examples.html"><a href="integrative-examples.html"><i class="fa fa-check"></i><b>3.9</b> Integrative examples</a><ul>
<li class="chapter" data-level="3.9.1" data-path="integrative-examples.html"><a href="integrative-examples.html#fastqc-web-application"><i class="fa fa-check"></i><b>3.9.1</b> FASTQC Web Application</a></li>
<li class="chapter" data-level="3.9.2" data-path="integrative-examples.html"><a href="integrative-examples.html#shiny-application"><i class="fa fa-check"></i><b>3.9.2</b> Shiny Application</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="publish-images.html"><a href="publish-images.html"><i class="fa fa-check"></i><b>3.10</b> Publish images</a><ul>
<li class="chapter" data-level="3.10.1" data-path="publish-images.html"><a href="publish-images.html#push-an-image"><i class="fa fa-check"></i><b>3.10.1</b> Push an image</a></li>
<li class="chapter" data-level="3.10.2" data-path="publish-images.html"><a href="publish-images.html#automatic-builds"><i class="fa fa-check"></i><b>3.10.2</b> Automatic builds</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="exercise-3-docker-volumes-and-ports.html"><a href="exercise-3-docker-volumes-and-ports.html"><i class="fa fa-check"></i><b>3.11</b> Exercise 3 - Docker volumes and ports</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="singularity.html"><a href="singularity.html"><i class="fa fa-check"></i><b>4</b> Singularity</a><ul>
<li class="chapter" data-level="4.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html"><i class="fa fa-check"></i><b>4.1</b> Introduction to Singularity</a><ul>
<li class="chapter" data-level="4.1.1" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#singularity-architecture"><i class="fa fa-check"></i><b>4.1.1</b> Singularity architecture</a></li>
<li class="chapter" data-level="4.1.2" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#strengths"><i class="fa fa-check"></i><b>4.1.2</b> Strengths</a></li>
<li class="chapter" data-level="4.1.3" data-path="introduction-to-singularity.html"><a href="introduction-to-singularity.html#weaknesses"><i class="fa fa-check"></i><b>4.1.3</b> Weaknesses</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="build-process.html"><a href="build-process.html"><i class="fa fa-check"></i><b>4.2</b> Build process</a><ul>
<li class="chapter" data-level="4.2.1" data-path="build-process.html"><a href="build-process.html#examples"><i class="fa fa-check"></i><b>4.2.1</b> Examples</a></li>
<li class="chapter" data-level="4.2.2" data-path="build-process.html"><a href="build-process.html#sandboxing"><i class="fa fa-check"></i><b>4.2.2</b> Sandboxing</a></li>
<li class="chapter" data-level="4.2.3" data-path="build-process.html"><a href="build-process.html#singularity-recipes"><i class="fa fa-check"></i><b>4.2.3</b> Singularity recipes</a></li>
<li class="chapter" data-level="4.2.4" data-path="build-process.html"><a href="build-process.html#remote-building"><i class="fa fa-check"></i><b>4.2.4</b> Remote building</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html"><i class="fa fa-check"></i><b>4.3</b> Run and execution process</a><ul>
<li class="chapter" data-level="4.3.1" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-shell"><i class="fa fa-check"></i><b>4.3.1</b> Singularity shell</a></li>
<li class="chapter" data-level="4.3.2" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-exec"><i class="fa fa-check"></i><b>4.3.2</b> Singularity exec</a></li>
<li class="chapter" data-level="4.3.3" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#singularity-run"><i class="fa fa-check"></i><b>4.3.3</b> Singularity run</a></li>
<li class="chapter" data-level="4.3.4" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#environment-control"><i class="fa fa-check"></i><b>4.3.4</b> Environment control</a></li>
<li class="chapter" data-level="4.3.5" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#execute-from-sandboxed-images-directories"><i class="fa fa-check"></i><b>4.3.5</b> Execute from sandboxed images / directories</a></li>
<li class="chapter" data-level="4.3.6" data-path="run-and-execution-process.html"><a href="run-and-execution-process.html#execute-straight-from-a-registry"><i class="fa fa-check"></i><b>4.3.6</b> Execute straight from a registry</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="bind-paths-aka-volumes.html"><a href="bind-paths-aka-volumes.html"><i class="fa fa-check"></i><b>4.4</b> Bind paths (aka volumes)</a></li>
<li class="chapter" data-level="4.5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>4.5</b> Exercises:</a></li>
<li class="chapter" data-level="4.6" data-path="instances.html"><a href="instances.html"><i class="fa fa-check"></i><b>4.6</b> Instances</a></li>
<li class="chapter" data-level="4.7" data-path="troubleshooting.html"><a href="troubleshooting.html"><i class="fa fa-check"></i><b>4.7</b> Troubleshooting</a><ul>
<li class="chapter" data-level="4.7.1" data-path="troubleshooting.html"><a href="troubleshooting.html#fakeroot"><i class="fa fa-check"></i><b>4.7.1</b> Fakeroot</a></li>
<li class="chapter" data-level="4.7.2" data-path="troubleshooting.html"><a href="troubleshooting.html#singularity-cache-directory"><i class="fa fa-check"></i><b>4.7.2</b> Singularity cache directory</a></li>
<li class="chapter" data-level="4.7.3" data-path="troubleshooting.html"><a href="troubleshooting.html#global-singularity-configuration"><i class="fa fa-check"></i><b>4.7.3</b> Global singularity configuration</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="exercise-4-singularity-running-and-building.html"><a href="exercise-4-singularity-running-and-building.html"><i class="fa fa-check"></i><b>4.8</b> Exercise 4 - Singularity running and building</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="nextflow-day-1.html"><a href="nextflow-day-1.html"><i class="fa fa-check"></i><b>5</b> Nextflow day 1</a><ul>
<li class="chapter" data-level="5.1" data-path="what-is-nextflow.html"><a href="what-is-nextflow.html"><i class="fa fa-check"></i><b>5.1</b> What is Nextflow?</a></li>
<li class="chapter" data-level="5.2" data-path="what-is-nextflow-for.html"><a href="what-is-nextflow-for.html"><i class="fa fa-check"></i><b>5.2</b> What is Nextflow for?</a></li>
<li class="chapter" data-level="5.3" data-path="main-advantages.html"><a href="main-advantages.html"><i class="fa fa-check"></i><b>5.3</b> Main advantages</a></li>
<li class="chapter" data-level="5.4" data-path="workflow-structure.html"><a href="workflow-structure.html"><i class="fa fa-check"></i><b>5.4</b> Workflow structure</a></li>
<li class="chapter" data-level="5.5" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>5.5</b> Installation</a></li>
<li class="chapter" data-level="5.6" data-path="channels-and-operators.html"><a href="channels-and-operators.html"><i class="fa fa-check"></i><b>5.6</b> Channels and Operators</a></li>
<li class="chapter" data-level="5.7" data-path="exercise-1.html"><a href="exercise-1.html"><i class="fa fa-check"></i><b>5.7</b> EXERCISE 1</a></li>
<li class="chapter" data-level="5.8" data-path="processes.html"><a href="processes.html"><i class="fa fa-check"></i><b>5.8</b> Processes</a></li>
<li class="chapter" data-level="5.9" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>5.9</b> Workflow</a></li>
<li class="chapter" data-level="5.10" data-path="nextflow-log.html"><a href="nextflow-log.html"><i class="fa fa-check"></i><b>5.10</b> Nextflow log</a></li>
<li class="chapter" data-level="5.11" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i><b>5.11</b> EXERCISE 2</a></li>
<li class="chapter" data-level="5.12" data-path="more-complex-scripts.html"><a href="more-complex-scripts.html"><i class="fa fa-check"></i><b>5.12</b> More complex scripts</a></li>
<li class="chapter" data-level="5.13" data-path="directives.html"><a href="directives.html"><i class="fa fa-check"></i><b>5.13</b> Directives</a></li>
<li class="chapter" data-level="5.14" data-path="resuming-your-pipeline.html"><a href="resuming-your-pipeline.html"><i class="fa fa-check"></i><b>5.14</b> Resuming your pipeline</a></li>
<li class="chapter" data-level="5.15" data-path="exercise-3.html"><a href="exercise-3.html"><i class="fa fa-check"></i><b>5.15</b> EXERCISE 3</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nextflow-day-2.html"><a href="nextflow-day-2.html"><i class="fa fa-check"></i><b>6</b> Nextflow day 2</a><ul>
<li class="chapter" data-level="6.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html"><i class="fa fa-check"></i><b>6.1</b> Decoupling resources, parameters and nextflow script</a><ul>
<li class="chapter" data-level="6.1.1" data-path="decoupling-resources-parameters-and-nextflow-script.html"><a href="decoupling-resources-parameters-and-nextflow-script.html#publishing-final-results"><i class="fa fa-check"></i><b>6.1.1</b> Publishing final results</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="adding-a-help-section-for-the-whole-pipeline.html"><a href="adding-a-help-section-for-the-whole-pipeline.html"><i class="fa fa-check"></i><b>6.2</b> Adding a help section for the whole pipeline</a></li>
<li class="chapter" data-level="6.3" data-path="exercise-4.html"><a href="exercise-4.html"><i class="fa fa-check"></i><b>6.3</b> Exercise 4</a></li>
<li class="chapter" data-level="6.4" data-path="using-singularity.html"><a href="using-singularity.html"><i class="fa fa-check"></i><b>6.4</b> Using Singularity</a></li>
<li class="chapter" data-level="6.5" data-path="adding-more-steps.html"><a href="adding-more-steps.html"><i class="fa fa-check"></i><b>6.5</b> Adding more steps</a></li>
<li class="chapter" data-level="6.6" data-path="profiles.html"><a href="profiles.html"><i class="fa fa-check"></i><b>6.6</b> Profiles</a></li>
<li class="chapter" data-level="6.7" data-path="deployment-in-the-aws-cloud.html"><a href="deployment-in-the-aws-cloud.html"><i class="fa fa-check"></i><b>6.7</b> Deployment in the AWS cloud</a></li>
<li class="chapter" data-level="6.8" data-path="exercise-5.html"><a href="exercise-5.html"><i class="fa fa-check"></i><b>6.8</b> Exercise 5</a></li>
<li class="chapter" data-level="6.9" data-path="modules-and-re-usage-of-the-code.html"><a href="modules-and-re-usage-of-the-code.html"><i class="fa fa-check"></i><b>6.9</b> Modules and re-usage of the code</a></li>
<li class="chapter" data-level="6.10" data-path="exercise-6.html"><a href="exercise-6.html"><i class="fa fa-check"></i><b>6.10</b> EXERCISE 6</a></li>
<li class="chapter" data-level="6.11" data-path="reporting-and-graphical-interface.html"><a href="reporting-and-graphical-interface.html"><i class="fa fa-check"></i><b>6.11</b> Reporting and graphical interface</a></li>
<li class="chapter" data-level="6.12" data-path="share-nextflow-pipelines-and-good-practices.html"><a href="share-nextflow-pipelines-and-good-practices.html"><i class="fa fa-check"></i><b>6.12</b> Share Nextflow pipelines and good practices</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://biocore.crg.eu/wiki/Main_Page" target="blank">BIOINFORMATICS CORE @ CRG</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Courses @ CRG: Reproducible research and data analysis with Linux containers and Nextflow pipelines</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="more-complex-scripts" class="section level2">
<h2><span class="header-section-number">5.12</span> More complex scripts</h2>
<p>We can feed the channel that is generated by a process to another process in the workflow definition. In this way we have a proper pipeline.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb143-1"><a href="more-complex-scripts.html#cb143-1"></a>#!/usr/bin/env nextflow</span>
<span id="cb143-2"><a href="more-complex-scripts.html#cb143-2"></a></span>
<span id="cb143-3"><a href="more-complex-scripts.html#cb143-3"></a>nextflow.<span class="fu">enable</span>.<span class="fu">dsl</span>=<span class="dv">2</span></span>
<span id="cb143-4"><a href="more-complex-scripts.html#cb143-4"></a></span>
<span id="cb143-5"><a href="more-complex-scripts.html#cb143-5"></a><span class="co">// this can be overridden by using --inputfile OTHERFILENAME</span></span>
<span id="cb143-6"><a href="more-complex-scripts.html#cb143-6"></a>params.<span class="fu">inputfile</span> = <span class="st">&quot;$baseDir/testdata/test.fa&quot;</span></span>
<span id="cb143-7"><a href="more-complex-scripts.html#cb143-7"></a></span>
<span id="cb143-8"><a href="more-complex-scripts.html#cb143-8"></a><span class="co">// the &quot;file method&quot; returns a file system object given a file path string  </span></span>
<span id="cb143-9"><a href="more-complex-scripts.html#cb143-9"></a>sequences_file = <span class="fu">file</span>(params.<span class="fu">inputfile</span>)             </span>
<span id="cb143-10"><a href="more-complex-scripts.html#cb143-10"></a></span>
<span id="cb143-11"><a href="more-complex-scripts.html#cb143-11"></a><span class="co">// check if the file exists</span></span>
<span id="cb143-12"><a href="more-complex-scripts.html#cb143-12"></a><span class="kw">if</span>( !sequences_file.<span class="fu">exists</span>() ) exit <span class="dv">1</span>, <span class="st">&quot;Missing genome file: ${genome_file}&quot;</span></span>
<span id="cb143-13"><a href="more-complex-scripts.html#cb143-13"></a></span>
<span id="cb143-14"><a href="more-complex-scripts.html#cb143-14"></a></span>
<span id="cb143-15"><a href="more-complex-scripts.html#cb143-15"></a><span class="co">/*</span></span>
<span id="cb143-16"><a href="more-complex-scripts.html#cb143-16"></a><span class="co"> * Process 1 for splitting a fasta file in multiple files</span></span>
<span id="cb143-17"><a href="more-complex-scripts.html#cb143-17"></a><span class="co"> */</span></span>
<span id="cb143-18"><a href="more-complex-scripts.html#cb143-18"></a></span>
<span id="cb143-19"><a href="more-complex-scripts.html#cb143-19"></a>process splitSequences {</span>
<span id="cb143-20"><a href="more-complex-scripts.html#cb143-20"></a></span>
<span id="cb143-21"><a href="more-complex-scripts.html#cb143-21"></a>    input:</span>
<span id="cb143-22"><a href="more-complex-scripts.html#cb143-22"></a>    path sequencesFile</span>
<span id="cb143-23"><a href="more-complex-scripts.html#cb143-23"></a></span>
<span id="cb143-24"><a href="more-complex-scripts.html#cb143-24"></a>    output:</span>
<span id="cb143-25"><a href="more-complex-scripts.html#cb143-25"></a>    <span class="fu">path</span> (&#39;seq_*&#39;)    </span>
<span id="cb143-26"><a href="more-complex-scripts.html#cb143-26"></a></span>
<span id="cb143-27"><a href="more-complex-scripts.html#cb143-27"></a>    <span class="co">// simple awk command</span></span>
<span id="cb143-28"><a href="more-complex-scripts.html#cb143-28"></a>    script:</span>
<span id="cb143-29"><a href="more-complex-scripts.html#cb143-29"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb143-30"><a href="more-complex-scripts.html#cb143-30"></a>    awk &#39;/^&gt;/{f=<span class="st">&quot;seq_&quot;</span>++d} {print &gt; f}&#39; &lt; ${sequencesFile}</span>
<span id="cb143-31"><a href="more-complex-scripts.html#cb143-31"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb143-32"><a href="more-complex-scripts.html#cb143-32"></a>}</span>
<span id="cb143-33"><a href="more-complex-scripts.html#cb143-33"></a></span>
<span id="cb143-34"><a href="more-complex-scripts.html#cb143-34"></a></span>
<span id="cb143-35"><a href="more-complex-scripts.html#cb143-35"></a><span class="co">/*</span></span>
<span id="cb143-36"><a href="more-complex-scripts.html#cb143-36"></a><span class="co"> * Process 2 for reversing the sequences</span></span>
<span id="cb143-37"><a href="more-complex-scripts.html#cb143-37"></a><span class="co"> */</span></span>
<span id="cb143-38"><a href="more-complex-scripts.html#cb143-38"></a></span>
<span id="cb143-39"><a href="more-complex-scripts.html#cb143-39"></a>process reverseSequence {</span>
<span id="cb143-40"><a href="more-complex-scripts.html#cb143-40"></a>    tag <span class="st">&quot;$seq&quot;</span>                  </span>
<span id="cb143-41"><a href="more-complex-scripts.html#cb143-41"></a></span>
<span id="cb143-42"><a href="more-complex-scripts.html#cb143-42"></a>    input:</span>
<span id="cb143-43"><a href="more-complex-scripts.html#cb143-43"></a>    path seq</span>
<span id="cb143-44"><a href="more-complex-scripts.html#cb143-44"></a></span>
<span id="cb143-45"><a href="more-complex-scripts.html#cb143-45"></a>    output:</span>
<span id="cb143-46"><a href="more-complex-scripts.html#cb143-46"></a>    path <span class="st">&quot;all.rev&quot;</span></span>
<span id="cb143-47"><a href="more-complex-scripts.html#cb143-47"></a></span>
<span id="cb143-48"><a href="more-complex-scripts.html#cb143-48"></a>    script:</span>
<span id="cb143-49"><a href="more-complex-scripts.html#cb143-49"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb143-50"><a href="more-complex-scripts.html#cb143-50"></a>    cat ${seq} | awk &#39;{<span class="kw">if</span> (\$<span class="dv">1</span>~<span class="st">&quot;&gt;&quot;</span>) {print \$<span class="dv">0</span>} <span class="kw">else</span> <span class="fu">system</span>(<span class="st">&quot;echo &quot;</span> \$<span class="dv">0</span> <span class="st">&quot; |rev&quot;</span>)}&#39; &gt; all.<span class="fu">rev</span></span>
<span id="cb143-51"><a href="more-complex-scripts.html#cb143-51"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb143-52"><a href="more-complex-scripts.html#cb143-52"></a>}</span>
<span id="cb143-53"><a href="more-complex-scripts.html#cb143-53"></a></span>
<span id="cb143-54"><a href="more-complex-scripts.html#cb143-54"></a>workflow {</span>
<span id="cb143-55"><a href="more-complex-scripts.html#cb143-55"></a>    splitted_seq    = <span class="fu">splitSequences</span>(sequences_file)</span>
<span id="cb143-56"><a href="more-complex-scripts.html#cb143-56"></a></span>
<span id="cb143-57"><a href="more-complex-scripts.html#cb143-57"></a>    <span class="co">// Here you have the output channel as a collection</span></span>
<span id="cb143-58"><a href="more-complex-scripts.html#cb143-58"></a>    splitted_seq.<span class="fu">view</span>()</span>
<span id="cb143-59"><a href="more-complex-scripts.html#cb143-59"></a></span>
<span id="cb143-60"><a href="more-complex-scripts.html#cb143-60"></a>    <span class="co">// Here you have the same channel reshaped to send separately each value</span></span>
<span id="cb143-61"><a href="more-complex-scripts.html#cb143-61"></a>    splitted_seq.<span class="fu">flatten</span>().<span class="fu">view</span>()</span>
<span id="cb143-62"><a href="more-complex-scripts.html#cb143-62"></a></span>
<span id="cb143-63"><a href="more-complex-scripts.html#cb143-63"></a>    <span class="co">// DLS2 allows you to reuse the channels! In past you had to create many identical</span></span>
<span id="cb143-64"><a href="more-complex-scripts.html#cb143-64"></a>    <span class="co">// channels for sending the same kind of data to different processes</span></span>
<span id="cb143-65"><a href="more-complex-scripts.html#cb143-65"></a></span>
<span id="cb143-66"><a href="more-complex-scripts.html#cb143-66"></a>    rev_single_seq  = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb143-67"><a href="more-complex-scripts.html#cb143-67"></a>}</span></code></pre></div>
<p>Here we have two simple processes:</p>
<ul>
<li>the former splits the input fasta file in single sequences</li>
<li>the latter is able to reverse the position of the sequences.</li>
</ul>
<p>The input path is fed as a parameter using the script parameters <strong>${seq}</strong></p>
<pre><code>params.inputfile</code></pre>
<p>In this way this value can be overridden when calling the script in this way:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb145-1"><a href="more-complex-scripts.html#cb145-1"></a><span class="ex">nextflow</span> run test.nf --inputfile another_input.fa</span></code></pre></div>
<p>The workflow part connects the two processes so that the output of the first process is fed to the second one.</p>
<p>During the execution Nextflow creates a number of temporary folders and this time will make also a soft link to the original input file. Then it will store output files locally.</p>
<p>The output file is then linked in other folders for being used as input from other processes. In this way there are no clashes and each process is nicely isolated from the others.</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb146-1"><a href="more-complex-scripts.html#cb146-1"></a><span class="ex">nextflow</span> run test.nf -bg</span>
<span id="cb146-2"><a href="more-complex-scripts.html#cb146-2"></a><span class="ex">N</span> E X T F L O W  ~  version 20.07.1</span>
<span id="cb146-3"><a href="more-complex-scripts.html#cb146-3"></a><span class="ex">Launching</span> <span class="kw">`</span><span class="ex">test.nf</span><span class="kw">`</span> [sad_newton] - revision: 82e66714e4</span>
<span id="cb146-4"><a href="more-complex-scripts.html#cb146-4"></a>[<span class="ex">09</span>/<span class="ex">53e071</span>] Submitted process <span class="op">&gt;</span> splitSequences</span>
<span id="cb146-5"><a href="more-complex-scripts.html#cb146-5"></a>[<span class="ex">/home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59</span>/<span class="ex">seq_1</span>, /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2, /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3]</span>
<span id="cb146-6"><a href="more-complex-scripts.html#cb146-6"></a><span class="ex">/home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_1</span></span>
<span id="cb146-7"><a href="more-complex-scripts.html#cb146-7"></a><span class="ex">/home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2</span></span>
<span id="cb146-8"><a href="more-complex-scripts.html#cb146-8"></a><span class="ex">/home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3</span></span>
<span id="cb146-9"><a href="more-complex-scripts.html#cb146-9"></a>[<span class="ex">fe</span>/<span class="ex">0a8640</span>] Submitted process <span class="op">&gt;</span> reverseSequence ([seq_1, seq_2, seq_3])</span></code></pre></div>
<p>if we inspect the content of work/09/53e071* generated by the process <strong>splitSequences</strong></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb147-1"><a href="more-complex-scripts.html#cb147-1"></a><span class="fu">ls</span> -l work/09/53e071*</span>
<span id="cb147-2"><a href="more-complex-scripts.html#cb147-2"></a><span class="ex">total</span> 24</span>
<span id="cb147-3"><a href="more-complex-scripts.html#cb147-3"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  29 Oct  8 19:16 seq_1</span>
<span id="cb147-4"><a href="more-complex-scripts.html#cb147-4"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  33 Oct  8 19:16 seq_2</span>
<span id="cb147-5"><a href="more-complex-scripts.html#cb147-5"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  27 Oct  8 19:16 seq_3</span>
<span id="cb147-6"><a href="more-complex-scripts.html#cb147-6"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  69 Oct  8 19:16 test.fa -<span class="op">&gt;</span> /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/testdata/test.fa</span></code></pre></div>
<p>we have the file test.fa that is a soft link to the orinal input. And inspecting work/fe/0a8640* that is generated by the process <strong>reverseSequence</strong> reveals that the files generated by <strong>splitSequences</strong> are now linked as input.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb148-1"><a href="more-complex-scripts.html#cb148-1"></a><span class="fu">ls</span> -l work/fe/0a8640*</span>
<span id="cb148-2"><a href="more-complex-scripts.html#cb148-2"></a><span class="ex">total</span> 8</span>
<span id="cb148-3"><a href="more-complex-scripts.html#cb148-3"></a><span class="ex">-rw-r--r--</span>  1 lcozzuto  staff  89 Oct  8 19:16 all.rev</span>
<span id="cb148-4"><a href="more-complex-scripts.html#cb148-4"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_1 -<span class="op">&gt;</span> /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_1</span>
<span id="cb148-5"><a href="more-complex-scripts.html#cb148-5"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_2 -<span class="op">&gt;</span> /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_2</span>
<span id="cb148-6"><a href="more-complex-scripts.html#cb148-6"></a><span class="ex">lrwxr-xr-x</span>  1 lcozzuto  staff  97 Oct  8 19:16 seq_3 -<span class="op">&gt;</span> /home/ec2-user/git/CoursesCRG_Containers_Nextflow_May_2021/nextflow/nextflow/work/09/53e071d286ed66f4020869c8977b59/seq_3</span></code></pre></div>
<p><strong>IMPORTANT: Nextflow will randomly generate temporary folders so they will be named differently in your execution!!!</strong></p>
<p>At this point we can make two different workflows so that we show how the new DSL allows reusing of the code.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode java"><code class="sourceCode java"><span id="cb149-1"><a href="more-complex-scripts.html#cb149-1"></a>#!/usr/bin/env nextflow</span>
<span id="cb149-2"><a href="more-complex-scripts.html#cb149-2"></a></span>
<span id="cb149-3"><a href="more-complex-scripts.html#cb149-3"></a>nextflow.<span class="fu">enable</span>.<span class="fu">dsl</span>=<span class="dv">2</span></span>
<span id="cb149-4"><a href="more-complex-scripts.html#cb149-4"></a></span>
<span id="cb149-5"><a href="more-complex-scripts.html#cb149-5"></a><span class="co">// this can be overridden by using --inputfile OTHERFILENAME</span></span>
<span id="cb149-6"><a href="more-complex-scripts.html#cb149-6"></a>params.<span class="fu">inputfile</span> = <span class="st">&quot;$baseDir/testdata/test.fa&quot;</span></span>
<span id="cb149-7"><a href="more-complex-scripts.html#cb149-7"></a></span>
<span id="cb149-8"><a href="more-complex-scripts.html#cb149-8"></a><span class="co">// the &quot;file method&quot; returns a file system object given a file path string  </span></span>
<span id="cb149-9"><a href="more-complex-scripts.html#cb149-9"></a>sequences_file = <span class="fu">file</span>(params.<span class="fu">inputfile</span>)             </span>
<span id="cb149-10"><a href="more-complex-scripts.html#cb149-10"></a></span>
<span id="cb149-11"><a href="more-complex-scripts.html#cb149-11"></a><span class="co">// check if the file exists</span></span>
<span id="cb149-12"><a href="more-complex-scripts.html#cb149-12"></a><span class="kw">if</span>( !sequences_file.<span class="fu">exists</span>() ) exit <span class="dv">1</span>, <span class="st">&quot;Missing genome file: ${genome_file}&quot;</span></span>
<span id="cb149-13"><a href="more-complex-scripts.html#cb149-13"></a></span>
<span id="cb149-14"><a href="more-complex-scripts.html#cb149-14"></a></span>
<span id="cb149-15"><a href="more-complex-scripts.html#cb149-15"></a><span class="co">/*</span></span>
<span id="cb149-16"><a href="more-complex-scripts.html#cb149-16"></a><span class="co"> * Process 1 for splitting a fasta file in multiple files</span></span>
<span id="cb149-17"><a href="more-complex-scripts.html#cb149-17"></a><span class="co"> */</span></span>
<span id="cb149-18"><a href="more-complex-scripts.html#cb149-18"></a></span>
<span id="cb149-19"><a href="more-complex-scripts.html#cb149-19"></a>process splitSequences {</span>
<span id="cb149-20"><a href="more-complex-scripts.html#cb149-20"></a></span>
<span id="cb149-21"><a href="more-complex-scripts.html#cb149-21"></a>    input:</span>
<span id="cb149-22"><a href="more-complex-scripts.html#cb149-22"></a>    path sequencesFile</span>
<span id="cb149-23"><a href="more-complex-scripts.html#cb149-23"></a></span>
<span id="cb149-24"><a href="more-complex-scripts.html#cb149-24"></a>    output:</span>
<span id="cb149-25"><a href="more-complex-scripts.html#cb149-25"></a>    <span class="fu">path</span> (&#39;seq_*&#39;)    </span>
<span id="cb149-26"><a href="more-complex-scripts.html#cb149-26"></a></span>
<span id="cb149-27"><a href="more-complex-scripts.html#cb149-27"></a>    <span class="co">// simple awk command</span></span>
<span id="cb149-28"><a href="more-complex-scripts.html#cb149-28"></a></span>
<span id="cb149-29"><a href="more-complex-scripts.html#cb149-29"></a>    script:</span>
<span id="cb149-30"><a href="more-complex-scripts.html#cb149-30"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb149-31"><a href="more-complex-scripts.html#cb149-31"></a>    awk &#39;/^&gt;/{f=<span class="st">&quot;seq_&quot;</span>++d} {print &gt; f}&#39; &lt; ${sequencesFile}</span>
<span id="cb149-32"><a href="more-complex-scripts.html#cb149-32"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb149-33"><a href="more-complex-scripts.html#cb149-33"></a>}</span>
<span id="cb149-34"><a href="more-complex-scripts.html#cb149-34"></a></span>
<span id="cb149-35"><a href="more-complex-scripts.html#cb149-35"></a></span>
<span id="cb149-36"><a href="more-complex-scripts.html#cb149-36"></a><span class="co">/*</span></span>
<span id="cb149-37"><a href="more-complex-scripts.html#cb149-37"></a><span class="co"> * Process 2 for reversing the sequences</span></span>
<span id="cb149-38"><a href="more-complex-scripts.html#cb149-38"></a><span class="co"> */</span></span>
<span id="cb149-39"><a href="more-complex-scripts.html#cb149-39"></a></span>
<span id="cb149-40"><a href="more-complex-scripts.html#cb149-40"></a>process reverseSequence {</span>
<span id="cb149-41"><a href="more-complex-scripts.html#cb149-41"></a>    tag <span class="st">&quot;$seq&quot;</span>                  </span>
<span id="cb149-42"><a href="more-complex-scripts.html#cb149-42"></a></span>
<span id="cb149-43"><a href="more-complex-scripts.html#cb149-43"></a>    input:</span>
<span id="cb149-44"><a href="more-complex-scripts.html#cb149-44"></a>    path seq</span>
<span id="cb149-45"><a href="more-complex-scripts.html#cb149-45"></a></span>
<span id="cb149-46"><a href="more-complex-scripts.html#cb149-46"></a>    output:</span>
<span id="cb149-47"><a href="more-complex-scripts.html#cb149-47"></a>    path <span class="st">&quot;all.rev&quot;</span></span>
<span id="cb149-48"><a href="more-complex-scripts.html#cb149-48"></a></span>
<span id="cb149-49"><a href="more-complex-scripts.html#cb149-49"></a>    script:</span>
<span id="cb149-50"><a href="more-complex-scripts.html#cb149-50"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb149-51"><a href="more-complex-scripts.html#cb149-51"></a>    cat ${seq} | awk &#39;{<span class="kw">if</span> (\$<span class="dv">1</span>~<span class="st">&quot;&gt;&quot;</span>) {print \$<span class="dv">0</span>} <span class="kw">else</span> <span class="fu">system</span>(<span class="st">&quot;echo &quot;</span> \$<span class="dv">0</span> <span class="st">&quot; |rev&quot;</span>)}&#39; &gt; all.<span class="fu">rev</span></span>
<span id="cb149-52"><a href="more-complex-scripts.html#cb149-52"></a>    <span class="st">&quot;&quot;&quot;</span></span>
<span id="cb149-53"><a href="more-complex-scripts.html#cb149-53"></a>}</span>
<span id="cb149-54"><a href="more-complex-scripts.html#cb149-54"></a></span>
<span id="cb149-55"><a href="more-complex-scripts.html#cb149-55"></a>workflow flow1 {</span>
<span id="cb149-56"><a href="more-complex-scripts.html#cb149-56"></a>    take: sequences</span>
<span id="cb149-57"><a href="more-complex-scripts.html#cb149-57"></a>    main:</span>
<span id="cb149-58"><a href="more-complex-scripts.html#cb149-58"></a>    splitted_seq        = <span class="fu">splitSequences</span>(sequences)</span>
<span id="cb149-59"><a href="more-complex-scripts.html#cb149-59"></a>    rev_single_seq      = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb149-60"><a href="more-complex-scripts.html#cb149-60"></a>}</span>
<span id="cb149-61"><a href="more-complex-scripts.html#cb149-61"></a></span>
<span id="cb149-62"><a href="more-complex-scripts.html#cb149-62"></a>workflow flow2 {</span>
<span id="cb149-63"><a href="more-complex-scripts.html#cb149-63"></a>    take: sequences</span>
<span id="cb149-64"><a href="more-complex-scripts.html#cb149-64"></a>    main:</span>
<span id="cb149-65"><a href="more-complex-scripts.html#cb149-65"></a>    splitted_seq        = <span class="fu">splitSequences</span>(sequences).<span class="fu">flatten</span>()</span>
<span id="cb149-66"><a href="more-complex-scripts.html#cb149-66"></a>    rev_single_seq      = <span class="fu">reverseSequence</span>(splitted_seq)</span>
<span id="cb149-67"><a href="more-complex-scripts.html#cb149-67"></a></span>
<span id="cb149-68"><a href="more-complex-scripts.html#cb149-68"></a>}</span>
<span id="cb149-69"><a href="more-complex-scripts.html#cb149-69"></a></span>
<span id="cb149-70"><a href="more-complex-scripts.html#cb149-70"></a>workflow {</span>
<span id="cb149-71"><a href="more-complex-scripts.html#cb149-71"></a>   <span class="fu">flow1</span>(sequences_file)</span>
<span id="cb149-72"><a href="more-complex-scripts.html#cb149-72"></a>   <span class="fu">flow2</span>(sequences_file)</span>
<span id="cb149-73"><a href="more-complex-scripts.html#cb149-73"></a>}</span></code></pre></div>
<p>The first workflow will just run like the previous script, while the second will “flatten” the output of the first process and will launch the second process on each single sequence.</p>
<p>The <strong>reverseSequence</strong> processes of the second workflow will run in parallel if you have enough processors or you are in a cluster environment with a scheduler supported by Nextflow.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb150-1"><a href="more-complex-scripts.html#cb150-1"></a><span class="ex">nextflow</span> run test1.nf -bg</span>
<span id="cb150-2"><a href="more-complex-scripts.html#cb150-2"></a><span class="ex">C02WX1XFHV2Q</span>:nextflow lcozzuto$ N E X T F L O W  ~  version 20.07.1</span>
<span id="cb150-3"><a href="more-complex-scripts.html#cb150-3"></a><span class="ex">Launching</span> <span class="kw">`</span><span class="ex">test.nf</span><span class="kw">`</span> [insane_plateau] - revision: d33befe154</span>
<span id="cb150-4"><a href="more-complex-scripts.html#cb150-4"></a>[<span class="ex">bd</span>/<span class="ex">f4e9a6</span>] Submitted process <span class="op">&gt;</span> flow1:splitSequences</span>
<span id="cb150-5"><a href="more-complex-scripts.html#cb150-5"></a>[<span class="ex">37</span>/<span class="ex">d790ab</span>] Submitted process <span class="op">&gt;</span> flow2:splitSequences</span>
<span id="cb150-6"><a href="more-complex-scripts.html#cb150-6"></a>[<span class="ex">33</span>/<span class="ex">a6fc72</span>] Submitted process <span class="op">&gt;</span> flow1:reverseSequence ([seq_1, seq_2, seq_3])</span>
<span id="cb150-7"><a href="more-complex-scripts.html#cb150-7"></a>[<span class="ex">87</span>/<span class="ex">54bfe8</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_2)</span>
<span id="cb150-8"><a href="more-complex-scripts.html#cb150-8"></a>[<span class="ex">45</span>/<span class="ex">86dd83</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_1)</span>
<span id="cb150-9"><a href="more-complex-scripts.html#cb150-9"></a>[<span class="ex">93</span>/<span class="ex">c7b1c6</span>] Submitted process <span class="op">&gt;</span> flow2:reverseSequence (seq_3)</span></code></pre></div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="directives.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["courses_at_crg_2021.pdf", "courses_at_crg_2021.epub"],
"toc": {
"collapse": "section"
},
"search": true
});
});
</script>

</body>

</html>
